{"version":3,"sources":["..\\..\\..\\..\\assets\\script/assets\\script\\game.js"],"names":["Player","require","GameBg","Stick","GameOver","ScoreAni","Bridge","Fog","Energy","Shark","Stage","cc","Class","extends","Component","properties","player","gameBg","stick","bridge","fog","gameOver","scoreAni","energy","scoreDisplay","Label","scoreGroup","Node","gameOverSound","AudioClip","shark","stage","prefabs","Prefab","onLoad","init","configInit","node","opacity","runAction","fadeIn","Util","gameStartDataInit","_this","GameUITools","initPrefab","GameDataManager","toolChoose","localStorage","getItem","console","log","loadingLayer","GameConfig","IS_WX","on","isScreemCanTouch","isAnimate","gameTouchStartProcessing","isStartLengthen","gameTouchEndProcessing","modelChoose","parseInt","wx","request","url","INTER_URL","data","header","getStorageSync","method","success","res","status","gameId","gameLog","info","error","canShowGameOver","continueGame","setStagePosX","showStage","gameInit","setTool","gameContinueDataInit","string","totalScore","canResurrectTime","advBtn","active","reStartGame","loadingScene","isLengthen","buildBridge","readyToJump","director","getScene","children","getChildByName","guide","removeChild","setItem","length","getToolLength","moveDistance","Math","floor","currentPlat","x","width","distance","height","successOrlose","isShowFog","hideFog","lengthObj","getLength","min","max","culculateScore","nextPlat","isSuccess","isGameOver","Animation","toolRotateAni","setTimeout","run","successJump","jumpHeight","failJump","allMove","callbacks","move","gameMoveSpeed","bridgeY","setStick","setBridge","stop","gainScore","nextScore","showGameOver","scoreProcess","canSoundPlay","audioEngine","playEffect","scheduleOnce","hideStage","update","dt","isMove","createStage","recycleStage","showScoreFx","canDrop","drop"],"mappings":"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","file":"game.js","sourceRoot":"..\\..\\..\\..\\assets\\script","sourcesContent":["import Util from './utils/util' ;\r\nimport Animation from './utils/animation';\r\nimport GameUITools from './utils/GameUITools';\r\nimport GameConfig from './GameConfig' ;\r\nimport GameDataManager from './gameDataManager';\r\nvar Player = require('player');\r\nvar GameBg = require('gameBg');\r\nvar Stick = require('stick');\r\nvar GameOver = require('GameOver');\r\nvar ScoreAni = require('scoreAni');\r\nvar Bridge = require('bridge');\r\nvar Fog = require('fog');\r\nvar Energy = require('energy');\r\nvar Shark = require('shark');\r\nvar Stage = require('stage');\r\ncc.Class({\r\n    extends: cc.Component,\r\n    properties: {\r\n        player: Player,\r\n        gameBg: GameBg,\r\n        stick: Stick,\r\n        bridge:Bridge,\r\n        fog:Fog,\r\n        gameOver:GameOver,\r\n        scoreAni:ScoreAni,\r\n        energy:Energy,\r\n        scoreDisplay:cc.Label,\r\n        scoreGroup:cc.Node,\r\n        gameOverSound:cc.AudioClip,\r\n        shark:Shark,\r\n        stage: Stage,\r\n        prefabs:[cc.Prefab]\r\n    },\r\n    onLoad() {\r\n        this.gameBg.init(this);\r\n        this.gameOver.init(this);\r\n        this.energy.init(this);\r\n        this.bridge.init();\r\n        this.stick.init();\r\n        this.shark.init(this);\r\n        this.player.init(this);\r\n        this.init();\r\n        this.configInit();\r\n        this.node.opacity = 0;\r\n        this.stage.init(this);\r\n        this.node.runAction(cc.fadeIn(0.5));\r\n        Util.gameStartDataInit();\r\n    },\r\n    init: function () {\r\n        var _this = this;\r\n        GameUITools.initPrefab(this.prefabs[1]);\r\n        switch(GameDataManager.toolChoose){\r\n            case 0:\r\n                if(!localStorage.getItem(\"stickGuide\")){\r\n                    console.log('棍子新手引导')\r\n                    GameUITools.loadingLayer('panel/guide')\r\n                }\r\n                break;\r\n            case 1:\r\n                if(!localStorage.getItem(\"bridgeGuide\")){\r\n                    console.log('桥梁新手引导')\r\n                    GameUITools.loadingLayer('panel/guide')\r\n                }\r\n                break;\r\n            case 2:\r\n                if(!localStorage.getItem(\"jumpGuide\")){\r\n                    console.log('跳跃新手引导')\r\n                    GameUITools.loadingLayer('panel/guide')\r\n                }\r\n                break;\r\n        }\r\n        if(GameConfig.IS_WX){\r\n            GameUITools.initPrefab(this.prefabs[0]);\r\n        }\r\n        this.node.on('touchstart', function () {\r\n            if(GameConfig.isScreemCanTouch && !GameDataManager.isAnimate){\r\n                _this.gameTouchStartProcessing();\r\n            }\r\n        });\r\n        this.node.on('touchend', function () {\r\n            if(GameConfig.isScreemCanTouch){\r\n                if ( GameDataManager.isStartLengthen){\r\n                    _this.gameTouchEndProcessing();\r\n                }\r\n            }\r\n        });\r\n        //游戏开始获取id\r\n        if(GameConfig.IS_WX){\r\n            var modelChoose = parseInt(GameDataManager.toolChoose)+1\r\n            //游戏开始获取gameId\r\n            wx.request({\r\n                url:GameConfig.INTER_URL+\"game/start\",\r\n                data:{\r\n                    'model':modelChoose\r\n                },\r\n                header: {\r\n                    'content-type': 'application/x-www-form-urlencoded',\r\n                    'Cookie':\"SESSION=\"+wx.getStorageSync('sessionId')\r\n                },\r\n                method: \"POST\",\r\n                success:function (res) {\r\n                    console.log('游戏开始获取gameId返回值：',res.data)\r\n                    if(res.data.status == 1){\r\n                        GameDataManager.gameId = res.data.data;\r\n                    }\r\n                    else{\r\n                        Util.gameLog(res.data.info)\r\n                    }\r\n                },\r\n                error:function () {\r\n                    Util.gameLog(\"game/start接口调用失败\")\r\n                }\r\n            });\r\n        }\r\n    },\r\n    configInit: function () {\r\n        this.canShowGameOver = true\r\n    },\r\n    //游戏复活\r\n    continueGame: function () {\r\n        this.stage.setStagePosX();\r\n        this.stage.showStage();\r\n        switch(GameDataManager.toolChoose){\r\n            case 0:\r\n                this.stick.gameInit();\r\n                break;\r\n            case 1:\r\n                this.bridge.gameInit();\r\n                break;\r\n            case 2:\r\n                break;\r\n        }\r\n        this.player.gameInit();\r\n        this.shark.gameInit();\r\n        this.setTool();\r\n        Util.gameContinueDataInit();\r\n        this.configInit();\r\n        this.scoreDisplay.string = GameDataManager.totalScore;\r\n        if(GameConfig.canResurrectTime == 0){\r\n            this.gameOver.advBtn.active = false;\r\n        }\r\n        if(GameDataManager.toolChoose == 2){\r\n            this.energy.gameInit();\r\n        }\r\n        this.scoreGroup.opacity = 255;\r\n    },\r\n    //重开游戏\r\n    reStartGame: function () {\r\n        GameUITools.loadingScene(\"game\");\r\n    },\r\n    /**\r\n     * 游戏触摸开始数据处理\r\n     */\r\n    gameTouchStartProcessing(){\r\n        if(!GameDataManager.isAnimate){\r\n            GameDataManager.isLengthen = true;\r\n            GameDataManager.isStartLengthen = true;\r\n            switch(GameDataManager.toolChoose){\r\n                case 1:\r\n                    this.bridge.buildBridge();\r\n                    break;\r\n                case 2:\r\n                    this.player.readyToJump();\r\n                    break;\r\n            }\r\n            //删掉新手指引\r\n            if(cc.director.getScene().children[0].getChildByName(\"guide\")){\r\n                var guide =  cc.director.getScene().children[0].getChildByName(\"guide\");\r\n                cc.director.getScene().children[0].removeChild(guide)\r\n                cc.director.getScene().children[0].removeChild(guide)\r\n            }\r\n        }\r\n    },\r\n    /**\r\n     * 游戏触摸结束数据处理\r\n     */\r\n    gameTouchEndProcessing(){\r\n        GameDataManager.isLengthen = false;\r\n        switch(GameDataManager.toolChoose){\r\n            case 0:\r\n                if(!localStorage.getItem(\"stickGuide\")){\r\n                   localStorage.setItem('stickGuide',true)\r\n                }\r\n                break;\r\n            case 1:\r\n                if(!localStorage.getItem(\"bridgeGuide\")){\r\n                    localStorage.setItem('bridgeGuide',true)\r\n                }\r\n                break;\r\n            case 2:\r\n                if(!localStorage.getItem(\"jumpGuide\")){\r\n                    localStorage.setItem('jumpGuide',true)\r\n                }\r\n                break;\r\n        }\r\n        if(!GameDataManager.isAnimate){\r\n            var length = this.getToolLength();\r\n            if(GameDataManager.toolChoose <= 1){\r\n                GameDataManager.moveDistance =Math.floor(this.stage.currentPlat.x - this.player.node.x + length + this.stage.currentPlat.width/2)\r\n            }\r\n            else{\r\n                var distance = Math.floor(this.energy.energy.height/300*600);\r\n                GameDataManager.moveDistance =Math.floor(this.stage.currentPlat.x - this.player.node.x + distance + this.stage.currentPlat.width/2)\r\n            }\r\n            this.successOrlose(length);\r\n            if(GameDataManager.isShowFog){\r\n                this.fog.hideFog();\r\n            }\r\n            GameDataManager.isAnimate = true;\r\n        }\r\n    },\r\n    /**\r\n     * 计算道具是否能完成过桥\r\n     */\r\n    successOrlose: function (length) {\r\n        var _this = this;\r\n        var lengthObj = this.stage.getLength();\r\n        //判断搭桥是否成功\r\n        if (lengthObj.min <= length && length <= lengthObj.max){\r\n            Util.culculateScore(this.stage.nextPlat,length,lengthObj.min);\r\n            GameDataManager.isSuccess = true;\r\n        }\r\n        else {\r\n            GameDataManager.isSuccess = false;\r\n        }\r\n\r\n        //道具执行动画\r\n        if(!GameDataManager.isGameOver){\r\n            switch(GameDataManager.toolChoose){\r\n                case 0:\r\n                    //棍子执行动画\r\n                    Animation.toolRotateAni( GameDataManager.isSuccess,this.stick.node);\r\n                    setTimeout(function () { _this.player.run()},700);\r\n                    break;\r\n                case 1:\r\n                    //桥执行动画\r\n                    Animation.toolRotateAni( GameDataManager.isSuccess,this.bridge.node);\r\n                    setTimeout(function () { _this.player.run() },700);\r\n                    break;\r\n                case 2:\r\n                    //跳跃执行动画\r\n                    if(GameDataManager.isSuccess){\r\n                        this.player.successJump(GameDataManager.moveDistance,_this.player.jumpHeight);\r\n                    }\r\n                    else{\r\n                        this.player.failJump(GameDataManager.moveDistance,_this.player.jumpHeight);\r\n                    }\r\n                    break;\r\n            }\r\n        }\r\n    },\r\n    /**\r\n     * 控制所有节点的移动\r\n     */\r\n    allMove: function (callbacks){\r\n        GameDataManager.move += GameConfig.gameMoveSpeed;\r\n        if (GameDataManager.move > (GameDataManager.moveDistance)) {\r\n            callbacks && callbacks();  //移动完执行\r\n        }\r\n    },\r\n    /**\r\n     * 获取道具长度\r\n     */\r\n    getToolLength:function(){\r\n        switch(GameDataManager.toolChoose){\r\n            case 0:\r\n                return this.stick.node.height;\r\n                break;\r\n            case 1:\r\n                return this.bridge.bridgeY;\r\n                break;\r\n            case 2:\r\n                return Math.floor(this.energy.energy.height/300*600);\r\n                break;\r\n        }\r\n    },\r\n    /**\r\n     * 设置道具\r\n     */\r\n    setTool:function(){\r\n        switch(GameDataManager.toolChoose){\r\n            case 0:\r\n                this.stick.setStick(this.stage.currentPlat.x + this.stage.currentPlat.width / 2)\r\n                break;\r\n            case 1:\r\n                this.bridge.setBridge(this.stage.currentPlat.x + this.stage.currentPlat.width / 2);\r\n                break;\r\n            case 2:\r\n                this.player.stop();\r\n                break;\r\n        }\r\n    },\r\n    //得分\r\n    gainScore: function () {\r\n        GameDataManager.totalScore += GameDataManager.nextScore;\r\n        this.scoreDisplay.string = GameDataManager.totalScore;\r\n    },\r\n    /**\r\n     * 游戏结束显示\r\n     */\r\n    showGameOver: function () {\r\n        var _this = this;\r\n        if (this.canShowGameOver) {\r\n            GameDataManager.isGameOver = true;\r\n            this.gameOver.scoreProcess();\r\n            if(GameDataManager.canSoundPlay){\r\n                cc.audioEngine.playEffect(_this.gameOverSound,false,1);\r\n            }\r\n            this.scheduleOnce(function() {\r\n                switch(GameDataManager.toolChoose){\r\n                    case 0:\r\n                        this.stick.node.opacity = 0;\r\n                        break;\r\n                    case 1:\r\n                        this.bridge.node.opacity = 0;\r\n                        break;\r\n                    case 2:\r\n                        this.energy.node.opacity = 0;\r\n                        break;\r\n                }\r\n                this.scoreGroup.opacity = 0;\r\n                this.gameOver.showGameOver();\r\n                this.stage.hideStage();\r\n            }, 1);\r\n            this.fog.hideFog();\r\n            if(GameConfig.canResurrectTime == 0){\r\n                this.gameOver.advBtn.active = false;\r\n            }\r\n            else{\r\n                this.gameOver.advBtn.active = true;\r\n            }\r\n        }\r\n        this.canShowGameOver = false;\r\n    },\r\n    update(dt) {\r\n        var _this = this;\r\n        if (GameDataManager.isAnimate) {\r\n            //所有对象移动，以及移动完的回调\r\n            if (GameDataManager.isMove) {\r\n                if(GameDataManager.isSuccess){\r\n                    this.allMove(function () {\r\n                        if(GameDataManager.isSuccess){\r\n                            GameDataManager.isMove = false;\r\n                            GameDataManager.isAnimate = false;\r\n                            GameDataManager.move = 0;\r\n                            _this.stage.createStage();\r\n                            _this.stage.recycleStage();\r\n                            if(GameDataManager.toolChoose !== 2){\r\n                                _this.gainScore();\r\n                                _this.scoreAni.showScoreFx();\r\n                            }\r\n                            _this.setTool();\r\n                            _this.player.stop();\r\n                            if(GameDataManager.toolChoose == 2){\r\n                                _this.energy.configInit();\r\n                            }\r\n                            GameDataManager.isStartLengthen = false;\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n            //人物掉落动画\r\n            if (!GameDataManager.isSuccess) {\r\n                if (GameDataManager.canDrop) {\r\n                    var moveDistance = this.stage.currentPlat.x-this.player.node.x+this.stage.currentPlat.width/2;\r\n                    this.player.drop(moveDistance);\r\n                    this.showGameOver();\r\n                    GameDataManager.canDrop = false;\r\n                }\r\n            }\r\n        }\r\n    }\r\n});\r\n\r\n"]}