{"version":3,"sources":["rank.js"],"names":["cc","Class","extends","Component","properties","inviteBtn","Node","closeBtn","btnSound","default","type","AudioClip","onLoad","init","zIndex","_this","loader","loadRes","err","prefab","node","instantiate","addChild","GameConfig","IS_WX","CC_WECHATGAME","tex","Texture2D","window","sharedCanvas","width","height","wx","postMessage","messageType","MAIN_MENU_NUM","on","e","stopPropagation","Util","btnEvent","auths_Btn","IS_AUTHORIZE","show","cur","director","getRunningScene","name","gameOverBannerAdv","console","log","GameDataManager","isHideSub","GameUITools","unLoadingLayer","shareAppMessage","title","config","shareTitle","imageUrl","shareImg","query","getStorageSync","request","url","INTER_URL","data","header","method","success","res","status","code","error","start","_updateSubDomainCanvas","openDataContext","getOpenDataContext","canvas","initWithElement","handleLoadedTexture","subCanvas","SpriteFrame","update"],"mappings":"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","file":"rank.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\panel","sourcesContent":["import Util from '../utils/util';\r\nimport GameUITools from '../utils/GameUITools';\r\nimport GameConfig from '../gameConfig';\r\nimport GameDataManager from '../gameDataManager';\r\ncc.Class({\r\n    extends: cc.Component,\r\n    properties: {\r\n        inviteBtn:cc.Node,\r\n        closeBtn:cc.Node,\r\n        btnSound:{\r\n            default: null,\r\n            type: cc.AudioClip\r\n        }\r\n    },\r\n    onLoad(){\r\n        this.init();\r\n        this.inviteBtn.zIndex = 10\r\n    },\r\n    init(){\r\n        var _this = this;\r\n        cc.loader.loadRes(\"panel/subCanvas\", (err, prefab) => {\r\n            if (!err) {\r\n                let node = cc.instantiate(prefab);\r\n                _this.node.addChild(node,5);\r\n            }\r\n        });\r\n        if(GameConfig.IS_WX){\r\n            if (CC_WECHATGAME) {\r\n                this.tex = new cc.Texture2D();\r\n                window.sharedCanvas.width = 750;\r\n                window.sharedCanvas.height = 1206;\r\n                wx.postMessage({\r\n                    messageType: 2, //获取排行榜\r\n                    MAIN_MENU_NUM: GameConfig.MAIN_MENU_NUM,\r\n                });\r\n            }\r\n        }\r\n        this.node.on('touchstart',function(e){\r\n            e.stopPropagation();\r\n        });\r\n        if(GameConfig.IS_WX){\r\n            Util.btnEvent(this.closeBtn,this.btnSound,function () {\r\n                if(GameConfig.IS_WX){\r\n                    if(GameConfig.auths_Btn){\r\n                        if(!GameConfig.IS_AUTHORIZE){\r\n                            GameConfig.auths_Btn.show();\r\n                        } \r\n                        var cur = cc.director.getRunningScene();\r\n                        if(typeof cur == \"object\" && cur.name == 'game')\r\n                        {\r\n                            if(GameConfig.gameOverBannerAdv){\r\n                                GameConfig.gameOverBannerAdv.show();\r\n                            }\r\n                        }\r\n                    }\r\n                    wx.postMessage({messageType: 3, MAIN_MENU_NUM: GameConfig.MAIN_MENU_NUM,});\r\n                    console.log(GameDataManager.isHideSub)\r\n                    if(GameDataManager.isHideSub){\r\n                        console.log('关闭排行榜隐藏子域')\r\n                        wx.postMessage({messageType: 5});\r\n                    }\r\n                }\r\n                GameUITools.unLoadingLayer(_this.node);\r\n            })\r\n            Util.btnEvent(this.inviteBtn,this.btnSound,function () {\r\n                wx.shareAppMessage({\r\n                    title:GameConfig.config.shareTitle,\r\n                    imageUrl:GameConfig.config.shareImg,\r\n                    query:\"shareCode=\"+wx.getStorageSync('shareCode')\r\n                });\r\n                wx.request({\r\n                    url:GameConfig.INTER_URL+\"game/share\",\r\n                    data:{\r\n                        'title': GameConfig.config.shareTitle,\r\n                        'image': GameConfig.config.shareImg,\r\n                        'query': wx.getStorageSync('shareCode')\r\n                    },\r\n                    header:{\r\n                        'content-type': 'application/x-www-form-urlencoded',\r\n                        'Cookie':\"SESSION=\"+wx.getStorageSync('sessionId')\r\n                    },\r\n                    method: \"POST\",\r\n                    success:function (res){\r\n                        console.log(res.data)\r\n                        if(res.data.status == 1){\r\n                            console.log(\"游戏分享保存成功\")\r\n                        }\r\n                        else{\r\n                            switch(res.data.code){\r\n                                case 1005:\r\n                                    console.log(\"游戏分享保存参数错误\")\r\n                                    break;\r\n                            }\r\n                        }\r\n                    },\r\n                    error:function (){\r\n                        console.log(\"连接错误\")\r\n                    }\r\n\r\n                })\r\n            })\r\n        }\r\n    },\r\n    start () {\r\n        this.tex = new cc.Texture2D();\r\n    },\r\n    //获取排行\r\n    // 刷新开放数据域的纹理\r\n    _updateSubDomainCanvas () {\r\n        if (!this.tex) {\r\n            return;\r\n        }\r\n        var openDataContext = wx.getOpenDataContext();\r\n        var sharedCanvas = openDataContext.canvas;\r\n        this.tex.initWithElement(sharedCanvas);\r\n        this.tex.handleLoadedTexture();\r\n        this.subCanvas = new cc.SpriteFrame(this.tex);\r\n    },\r\n    update () {\r\n        if(GameConfig.IS_WX){\r\n            this._updateSubDomainCanvas();\r\n        }\r\n    }\r\n});"]}