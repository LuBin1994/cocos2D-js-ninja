{"version":3,"sources":["rankList.js"],"names":["cc","Class","extends","Component","properties","display","Node","content","rankItem","Prefab","loadingLabel","scoreText","scoreTextLabel","Label","start","_self","wx","onMessage","messageType","data","_submitScore","MAIN_MENU_NUM","score","_fetchFriendData","_getScoreText","_hideSub","_removeChild","removeAllChildren","_showMessage","getUserCloudStorage","keyList","success","getres","KVDataList","length","setUserCloudStorage","key","value","Date","getTime","res","console","log","fail","complete","hideRankList","userRank","topperUserRank","lowerUserRank","getUserInfo","openIdList","userRes","active","userData","getFriendCloudStorage","sort","a","b","i","index","isSelf","avatarUrl","string","grade1","grade2","nickname","GameConfig","passNickName","shareKind","showRankList","_showPlayerData","message","getComponent","rank","playerInfo","node","instantiate","parent","num","getChildByName","toString","userName","grade","userIcon","children","Sprite","loader","load","url","type","err","texture","error","spriteFrame","SpriteFrame","_showUserData","nickName"],"mappings":"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","file":"rankList.js","sourceRoot":"..\\..\\..\\assets","sourcesContent":["import GameConfig from './gameConfig';\r\ncc.Class({\r\n    extends: cc.Component,\r\n    properties: {\r\n        display:cc.Node,\r\n        content: cc.Node,\r\n        rankItem: cc.Prefab,\r\n        loadingLabel: cc.Node,\r\n        scoreText: cc.Node,\r\n        scoreTextLabel:cc.Label,\r\n    },\r\n    start () {\r\n        let _self = this;\r\n        wx.onMessage(data => {\r\n            let messageType = data.messageType;\r\n            switch(messageType) {\r\n                case 1: // 提交分数\r\n                    _self._submitScore(data.MAIN_MENU_NUM, data.score);\r\n                    break;\r\n                case 2: // 获取排行榜\r\n                    _self._fetchFriendData(data.MAIN_MENU_NUM);\r\n                    break;\r\n                case 3://结束文字\r\n                    _self._getScoreText(data.MAIN_MENU_NUM);\r\n                    break;\r\n                case 5://隐藏子域\r\n                    _self._hideSub();\r\n                    break;\r\n            }\r\n        });\r\n    },\r\n    _removeChild() {\r\n        this.content.removeAllChildren();\r\n        this._showMessage(\"玩命加载中...\");\r\n    },\r\n    // 提交分数\r\n    _submitScore(MAIN_MENU_NUM, score) {\r\n        wx.getUserCloudStorage({\r\n            // 以key/value形式存储\r\n            keyList: [\"x2\" + MAIN_MENU_NUM],\r\n            success: function(getres) {\r\n                if (getres.KVDataList.length > 0) {\r\n                    if (MAIN_MENU_NUM == 1) { // TODO\r\n                        wx.setUserCloudStorage({\r\n                            KVDataList: [{\r\n                                key: \"Classic\",\r\n                                value: \"{\\\"wxgame\\\":{\\\"score\\\":\" + (getres.KVDataList[0].value > score ? getres.KVDataList[0].value : score) + \",\\\"update_time\\\": \" + new Date().getTime() + \"}}\"\r\n                            }],\r\n                        });\r\n                    }\r\n                    if (getres.KVDataList[0].value > score) {\r\n                        return ;\r\n                    }\r\n                }\r\n                // 对用户托管数据进行写数据操作\r\n                wx.setUserCloudStorage({\r\n                    KVDataList: [{\r\n                        key: \"x2\" + MAIN_MENU_NUM,\r\n                        value: \"\" + score,\r\n                    }],\r\n                    success: function(res) {\r\n                        console.log('setUserCloudStorage', 'success', res);\r\n                    },\r\n                    fail: function(res) {\r\n                        console.log('setUserCloudStorage', 'fail', res);\r\n                    },\r\n                    complete: function(res) {\r\n                        console.log('setUserCloudStorage', 'ok', res);\r\n                    }\r\n                });\r\n            },\r\n            fail: function(res) {\r\n                console.log(\"getUserCloudStorage\", \"fail\");\r\n            },\r\n            complete: function(res) {\r\n                console.log(\"getUserCloudStorage\", \"ok\");\r\n            },\r\n        });\r\n    },\r\n    //结束文字\r\n    _getScoreText(MAIN_MENU_NUM){\r\n        this._removeChild();\r\n        this.hideRankList();\r\n        let _self = this;\r\n        let userRank,topperUserRank,lowerUserRank;\r\n        wx.getUserInfo({\r\n            openIdList: ['selfOpenId'],\r\n            success: (userRes) => {\r\n                this.loadingLabel.active = false;\r\n                console.log('success', userRes.data);\r\n                let userData = userRes.data[0]; // 如果需要自己的\r\n                // 取出所有好友数据\r\n                wx.getFriendCloudStorage({\r\n                    keyList: [\"x2\" + MAIN_MENU_NUM],\r\n                    success: res => {\r\n                        console.log(\"wx.getFriendCloudStorage success\", res);\r\n                        let data = res.data;\r\n                        data.sort((a, b) => {\r\n                            if (a.KVDataList.length == 0 && b.KVDataList.length == 0) {\r\n                                return 0;\r\n                            }\r\n                            if (a.KVDataList.length == 0) {\r\n                                return 1;\r\n                            }\r\n                            if (b.KVDataList.length == 0) {\r\n                                return -1;\r\n                            }\r\n                            return b.KVDataList[0].value - a.KVDataList[0].value;\r\n                        });\r\n                        for(let i = 0; i < data.length; i++) {\r\n                            var index = i;\r\n                            let isSelf = false;\r\n                            if (data[i].avatarUrl == userData.avatarUrl) {\r\n                                isSelf = true;\r\n                                userRank = index;\r\n                                topperUserRank = index-1;\r\n                                lowerUserRank = index+1;\r\n                            }\r\n                        }\r\n                        if(userRank == 0){\r\n                            _self.scoreTextLabel.string = \"你在好友中占据第一!\";\r\n                        }\r\n                        else if(userRank == data.length-1){\r\n                            _self.scoreTextLabel.string = \"你在好友中垫底了，快快奋起直追吧!\";\r\n                        }\r\n                        else{\r\n                            let grade1 = data[userRank].KVDataList.length != 0 ? data[userRank].KVDataList[0].value : 0;\r\n                            let grade2 = data[topperUserRank].KVDataList.length != 0 ? data[topperUserRank].KVDataList[0].value : 0;\r\n                            let score = grade2 - grade1//距排名前一位好友分差\r\n                            console.log(data[lowerUserRank],data[topperUserRank])\r\n                            _self.scoreTextLabel.string = \"你已超过\"+data[lowerUserRank].nickname+\",\\n距离下一位好友\"+data[topperUserRank].nickname+\"还差\"+score+\"分\";\r\n                            GameConfig.passNickName = data[lowerUserRank].nickname;\r\n                            GameConfig.shareKind = 1;\r\n                        }\r\n                    },\r\n                    fail: res=>{\r\n                        _self._showMessage(\"获取数据失败，请检查网络连接\");\r\n                        console.log(\"获取排行榜失败\", res);\r\n                    },\r\n                });\r\n            },\r\n            fail: (res) => {\r\n                _self._showMessage(\"获取数据失败，请检查网络连接\");\r\n            }\r\n        });\r\n    },\r\n    // 获取排行榜数据\r\n    _fetchFriendData(MAIN_MENU_NUM) {\r\n        this._removeChild();\r\n        this.showRankList();\r\n        let _self = this;\r\n        wx.getUserInfo({\r\n            openIdList: ['selfOpenId'],\r\n            success: (userRes) => {\r\n                this.loadingLabel.active = false;\r\n                console.log('success', userRes.data);\r\n                let userData = userRes.data[0]; // 如果需要自己的\r\n                // 取出所有好友数据\r\n                wx.getFriendCloudStorage({\r\n                    keyList: [\"x2\" + MAIN_MENU_NUM],\r\n                    success: res => {\r\n                        console.log(\"wx.getFriendCloudStorage success\", res);\r\n                        let data = res.data;\r\n                        data.sort((a, b) => {\r\n                            if (a.KVDataList.length == 0 && b.KVDataList.length == 0) {\r\n                                return 0;\r\n                            }\r\n                            if (a.KVDataList.length == 0) {\r\n                                return 1;\r\n                            }\r\n                            if (b.KVDataList.length == 0) {\r\n                                return -1;\r\n                            }\r\n                            return b.KVDataList[0].value - a.KVDataList[0].value;\r\n                        });\r\n                        for(let i = 0; i < data.length; i++) {\r\n                            let isSelf = false;\r\n                            if (data[i].avatarUrl == userData.avatarUrl) {\r\n                                isSelf = true;\r\n                            }\r\n                            _self._showPlayerData(i, data[i], isSelf);\r\n                        }\r\n                    },\r\n                    fail: res=>{\r\n                        _self._showMessage(\"获取数据失败，请检查网络连接\");\r\n                        console.log(\"获取排行榜失败\", res);\r\n                    },\r\n                });\r\n            },\r\n            fail: (res) => {\r\n                _self._showMessage(\"获取数据失败，请检查网络连接\");\r\n            }\r\n        });\r\n    },\r\n    //显示加载信息\r\n    _showMessage(message) {\r\n        this.loadingLabel.getComponent(cc.Label).string = message;\r\n        this.loadingLabel.active = true;\r\n    },\r\n    /**\r\n     * 显示排行榜，绘制好友信息\r\n     * TODO: 对当前玩家的记录做特殊标识\r\n     */\r\n    _showPlayerData(rank, playerInfo, isSelf) {\r\n        let node = cc.instantiate(this.rankItem);\r\n        node.parent = this.content;\r\n        // 排名\r\n        let num = node.getChildByName('num').getComponent(cc.Label);\r\n        num.string = (rank + 1).toString();\r\n        // 昵称\r\n        let userName = node.getChildByName('nickName').getComponent(cc.Label);\r\n        userName.string = playerInfo.nickname;\r\n        // 得分\r\n        let score = node.getChildByName('score').getComponent(cc.Label);\r\n        let grade = playerInfo.KVDataList.length != 0 ? playerInfo.KVDataList[0].value : 0;\r\n        score.string = grade.toString();\r\n\r\n        let userIcon = node.getChildByName('mask').children[0].getComponent(cc.Sprite);\r\n\r\n        cc.loader.load({\r\n            url: playerInfo.avatarUrl,\r\n            type: 'png'\r\n        }, (err, texture) => {\r\n            if (err) console.error(err);\r\n            console.log(texture);\r\n            userIcon.spriteFrame = new cc.SpriteFrame(texture);\r\n        });\r\n    },\r\n    //隐藏玩家数据\r\n    hideRankList(){\r\n        this.display.active = false;\r\n        this.loadingLabel.active = false;\r\n        this.scoreText.active = true;\r\n    },\r\n    //显示玩家数据\r\n    showRankList(){\r\n        this.display.active = true;\r\n        this.scoreText.active = false;\r\n    },\r\n    //显示用户数据\r\n    _showUserData(nickName, avatarUrl) {\r\n        let node = cc.instantiate(this.rankItem);\r\n        node.parent = this.content;\r\n        let userName = node.getChildByName('nickName').getComponent(cc.Label);\r\n        let userIcon = node.getChildByName('mask').children[0].getComponent(cc.Sprite);\r\n\r\n        userName.string = nickName;\r\n        console.log(nickName + '\\'s info has been getten');\r\n        cc.loader.load({\r\n            url: avatarUrl,\r\n            type: 'png'\r\n        }, (err, texture) => {\r\n            if (err) console.error(err);\r\n            console.log(texture);\r\n            userIcon.spriteFrame = new cc.SpriteFrame(texture);\r\n        });\r\n    },\r\n    //隐藏子域\r\n    _hideSub(){\r\n        this.display.active = false;\r\n        this.loadingLabel.active = false;\r\n        this.scoreText.active = false;\r\n    },\r\n});\r\n"]}