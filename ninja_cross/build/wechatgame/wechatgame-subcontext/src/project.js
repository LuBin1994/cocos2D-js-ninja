window.__require=function e(t,a,n){function s(i,r){if(!a[i]){if(!t[i]){var c=i.split("/");if(c=c[c.length-1],!t[c]){var l="function"==typeof __require&&__require;if(!r&&l)return l(c,!0);if(o)return o(c,!0);throw new Error("Cannot find module '"+i+"'")}}var u=a[i]={exports:{}};t[i][0].call(u.exports,function(e){return s(t[i][1][e]||e)},u,u.exports,e,t,a,n)}return a[i].exports}for(var o="function"==typeof __require&&__require,i=0;i<n.length;i++)s(n[i]);return s}({rankList:[function(e,t,a){"use strict";cc._RF.push(t,"4d1937N7rZHfZJa8/er9y+A","rankList"),cc.Class({extends:cc.Component,properties:{display:cc.ScrollView,content:cc.Node,rankItem:cc.Prefab,loadingLabel:cc.Node,scoreText:cc.Node,scoreTextLabel:cc.Label},start:function(){var e=this;this.display.scrollToTop(0),wx.onMessage(function(t){switch(t.messageType){case 1:e._submitScore(t.MAIN_MENU_NUM,t.score);break;case 2:e._fetchFriendData(t.MAIN_MENU_NUM);break;case 3:e._getScoreText(t.MAIN_MENU_NUM);break;case 5:e._hideSub()}})},_removeChild:function(){this.content.removeAllChildren(),this._showMessage("\u73a9\u547d\u52a0\u8f7d\u4e2d...")},_submitScore:function(e,t){wx.getUserCloudStorage({keyList:["x2"+e],success:function(a){a.KVDataList.length>0&&(1==e&&wx.setUserCloudStorage({KVDataList:[{key:"Classic",value:'{"wxgame":{"score":'+(a.KVDataList[0].value>t?a.KVDataList[0].value:t)+',"update_time": '+(new Date).getTime()+"}}"}]}),a.KVDataList[0].value>t)||wx.setUserCloudStorage({KVDataList:[{key:"x2"+e,value:""+t}],success:function(e){console.log("setUserCloudStorage","success",e)},fail:function(e){console.log("setUserCloudStorage","fail",e)},complete:function(e){console.log("setUserCloudStorage","ok",e)}})},fail:function(e){console.log("getUserCloudStorage","fail")},complete:function(e){console.log("getUserCloudStorage","ok")}})},_getScoreText:function(e){var t=this;this._removeChild(),this.hideRankList();var a=this,n=void 0,s=void 0,o=void 0;wx.getUserInfo({openIdList:["selfOpenId"],success:function(i){t.loadingLabel.active=!1,console.log("success",i.data);var r=i.data[0];wx.getFriendCloudStorage({keyList:["x2"+e],success:function(e){console.log("wx.getFriendCloudStorage success",e);var t=e.data;t.sort(function(e,t){return 0==e.KVDataList.length&&0==t.KVDataList.length?0:0==e.KVDataList.length?1:0==t.KVDataList.length?-1:t.KVDataList[0].value-e.KVDataList[0].value});for(var i=0;i<t.length;i++){var c=i;t[i].avatarUrl==r.avatarUrl&&(!0,n=c,s=c-1,o=c+1)}if(0==n)a.scoreTextLabel.string="\u4f60\u5728\u597d\u53cb\u4e2d\u5360\u636e\u7b2c\u4e00!";else if(n==t.length-1)a.scoreTextLabel.string="\u4f60\u5728\u597d\u53cb\u4e2d\u57ab\u5e95\u4e86\uff0c\u5feb\u5feb\u594b\u8d77\u76f4\u8ffd\u5427!";else{var l=0!=t[n].KVDataList.length?t[n].KVDataList[0].value:0,u=(0!=t[s].KVDataList.length?t[s].KVDataList[0].value:0)-l,g=a._cutstr(t[s].nickname,4),h=a._cutstr(t[o].nickname,10);a.scoreTextLabel.string="\u4f60\u5df2\u8d85\u8fc7"+h+",\n\u8ddd\u79bb\u4e0b\u4e00\u4f4d\u597d\u53cb"+g+"\u8fd8\u5dee"+u+"\u5206"}},fail:function(e){a._showMessage("\u83b7\u53d6\u6570\u636e\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc\u8fde\u63a5"),console.log("\u83b7\u53d6\u6392\u884c\u699c\u5931\u8d25",e)}})},fail:function(e){a._showMessage("\u83b7\u53d6\u6570\u636e\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc\u8fde\u63a5")}})},_fetchFriendData:function(e){var t=this;this._removeChild(),this.showRankList();var a=this;wx.getUserInfo({openIdList:["selfOpenId"],success:function(n){t.loadingLabel.active=!1,console.log("success",n.data);var s=n.data[0];wx.getFriendCloudStorage({keyList:["x2"+e],success:function(e){console.log("wx.getFriendCloudStorage success",e);var t=e.data;t.sort(function(e,t){return 0==e.KVDataList.length&&0==t.KVDataList.length?0:0==e.KVDataList.length?1:0==t.KVDataList.length?-1:t.KVDataList[0].value-e.KVDataList[0].value});for(var n=0;n<t.length;n++){var o=!1;t[n].avatarUrl==s.avatarUrl&&(o=!0),a._showPlayerData(n,t[n],o)}},fail:function(e){a._showMessage("\u83b7\u53d6\u6570\u636e\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc\u8fde\u63a5"),console.log("\u83b7\u53d6\u6392\u884c\u699c\u5931\u8d25",e)}})},fail:function(e){a._showMessage("\u83b7\u53d6\u6570\u636e\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc\u8fde\u63a5")}})},_showMessage:function(e){this.loadingLabel.getComponent(cc.Label).string=e,this.loadingLabel.active=!0},_showPlayerData:function(e,t,a){var n=cc.instantiate(this.rankItem);n.parent=this.content,n.getChildByName("num").getComponent(cc.Label).string=(e+1).toString();var s=n.getChildByName("nickName").getComponent(cc.Label),o=this._cutstr(t.nickname,6);console.log(o),s.string=o;var i=n.getChildByName("score").getComponent(cc.Label),r=0!=t.KVDataList.length?t.KVDataList[0].value:0;i.string=r.toString();var c=n.getChildByName("userIcon").getComponent(cc.Sprite);""!=t.avatarUrl&&cc.loader.load({url:t.avatarUrl,type:"png"},function(e,t){e&&console.error(e),console.log(t),c.spriteFrame=new cc.SpriteFrame(t)})},hideRankList:function(){this.display.active=!1,this.loadingLabel.active=!1,this.scoreText.active=!0},showRankList:function(){this.display.active=!0,this.scoreText.active=!1},_showUserData:function(e,t){var a=cc.instantiate(this.rankItem);a.parent=this.content;var n=a.getChildByName("nickName").getComponent(cc.Label),s=a.getChildByName("mask").children[0].getComponent(cc.Sprite);n.string=nickNameStr,console.log(e+"'s info has been getten"),""!=t&&cc.loader.load({url:t,type:"png"},function(e,t){e&&console.error(e),console.log(t),s.spriteFrame=new cc.SpriteFrame(t)})},_hideSub:function(){this.display.active=!1,this.loadingLabel.active=!1,this.scoreText.active=!1},_cutstr:function(e,t){if(e.length<=t)return e;for(var a=0,n=new String,s=e.length,o=0;o<s;o++){var i=e.charAt(o);if(a++,n=n.concat(i),a>=t)return n=n.concat("...")}}}),cc._RF.pop()},{}]},{},["rankList"]);