window.__require=function e(t,a,o){function s(i,r){if(!a[i]){if(!t[i]){var c=i.split("/");if(c=c[c.length-1],!t[c]){var l="function"==typeof __require&&__require;if(!r&&l)return l(c,!0);if(n)return n(c,!0);throw new Error("Cannot find module '"+i+"'")}}var g=a[i]={exports:{}};t[i][0].call(g.exports,function(e){return s(t[i][1][e]||e)},g,g.exports,e,t,a,o)}return a[i].exports}for(var n="function"==typeof __require&&__require,i=0;i<o.length;i++)s(o[i]);return s}({rankList:[function(e,t,a){"use strict";cc._RF.push(t,"4d1937N7rZHfZJa8/er9y+A","rankList"),cc.Class({extends:cc.Component,properties:{display:cc.Node,content:cc.Node,rankItem:cc.Prefab,loadingLabel:cc.Node,scoreText:cc.Node,scoreTextLabel:cc.Label},start:function(){var e=this;wx.onMessage(function(t){switch(console.log(t),t.messageType){case 1:e._submitScore(t.MAIN_MENU_NUM,t.score);break;case 2:e._fetchFriendData(t.MAIN_MENU_NUM);break;case 3:e._getScoreText(t.MAIN_MENU_NUM)}})},_removeChild:function(){this.content.removeAllChildren(),this._showMessage("\u73a9\u547d\u52a0\u8f7d\u4e2d...")},_submitScore:function(e,t){console.log("\u63d0\u4ea4\u5206\u6570\u5f00\u59cb"),wx.getUserCloudStorage({keyList:["x"+e],success:function(a){console.log("getUserCloudStorage","success",a),a.KVDataList.length>0&&(1==e&&wx.setUserCloudStorage({KVDataList:[{key:"Classic",value:'{"wxgame":{"score":'+(a.KVDataList[0].value>t?a.KVDataList[0].value:t)+',"update_time": '+(new Date).getTime()+"}}"}]}),a.KVDataList[0].value>t)||wx.setUserCloudStorage({KVDataList:[{key:"x"+e,value:""+t}],success:function(e){console.log("setUserCloudStorage","success",e)},fail:function(e){console.log("setUserCloudStorage","fail",e)},complete:function(e){console.log("setUserCloudStorage","ok",e)}})},fail:function(e){console.log("getUserCloudStorage","fail")},complete:function(e){console.log("getUserCloudStorage","ok")}})},_getScoreText:function(e){var t=this;this._removeChild(),this.hideRnakList();var a=this,o=void 0,s=void 0,n=void 0;wx.getUserInfo({openIdList:["selfOpenId"],success:function(i){t.loadingLabel.active=!1,console.log("success",i.data);var r=i.data[0];wx.getFriendCloudStorage({keyList:["x"+e],success:function(e){console.log("wx.getFriendCloudStorage success",e);var t=e.data;t.sort(function(e,t){return 0==e.KVDataList.length&&0==t.KVDataList.length?0:0==e.KVDataList.length?1:0==t.KVDataList.length?-1:t.KVDataList[0].value-e.KVDataList[0].value});for(var i=0;i<t.length;i++){var c=i;t[i].avatarUrl==r.avatarUrl&&(!0,o=c,s=c-1,n=c+1)}if(0==o)a.scoreTextLabel.string="\u4f60\u5728\u597d\u53cb\u4e2d\u6392\u540d\u7b2c\u4e00\uff0c\u70ab\u8000\u4e00\u4e0b\u5427";else if(o==t.length)a.scoreTextLabel.string="\u4f60\u5728\u597d\u53cb\u4e2d\u57ab\u5e95\u4e86\uff0c\u5feb\u5feb\u594b\u8d77\u76f4\u8ffd\u5427";else{var l=0!=t[o].KVDataList.length?t[o].KVDataList[0].value:0,g=(0!=t[s].KVDataList.length?t[s].KVDataList[0].value:0)-l;a.scoreTextLabel.string="\u4f60\u5df2\u8d85\u8fc7"+t[n].nickname+",\n\u8ddd\u79bb\u4e0b\u4e00\u4f4d\u597d\u53cb"+t[s].nickname+"\u8fd8\u5dee"+g+"\u5206"}},fail:function(e){a._showMessage("\u83b7\u53d6\u6570\u636e\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc\u8fde\u63a5"),console.log("\u83b7\u53d6\u6392\u884c\u699c\u5931\u8d25",e)}})},fail:function(e){a._showMessage("\u83b7\u53d6\u6570\u636e\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc\u8fde\u63a5")}})},_fetchFriendData:function(e){var t=this;this._removeChild(),this.showRankList();var a=this;wx.getUserInfo({openIdList:["selfOpenId"],success:function(o){t.loadingLabel.active=!1,console.log("success",o.data);var s=o.data[0];wx.getFriendCloudStorage({keyList:["x"+e],success:function(e){console.log("wx.getFriendCloudStorage success",e);var t=e.data;t.sort(function(e,t){return 0==e.KVDataList.length&&0==t.KVDataList.length?0:0==e.KVDataList.length?1:0==t.KVDataList.length?-1:t.KVDataList[0].value-e.KVDataList[0].value});for(var o=0;o<t.length;o++){var n=!1;t[o].avatarUrl==s.avatarUrl&&(n=!0),a._showPlayerData(o,t[o],n)}},fail:function(e){a._showMessage("\u83b7\u53d6\u6570\u636e\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc\u8fde\u63a5"),console.log("\u83b7\u53d6\u6392\u884c\u699c\u5931\u8d25",e)}})},fail:function(e){a._showMessage("\u83b7\u53d6\u6570\u636e\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc\u8fde\u63a5")}})},_showMessage:function(e){this.loadingLabel.getComponent(cc.Label).string=e,this.loadingLabel.active=!0},_showPlayerData:function(e,t,a){var o=cc.instantiate(this.rankItem);o.parent=this.content,o.getChildByName("num").getComponent(cc.Label).string=(e+1).toString(),o.getChildByName("nickName").getComponent(cc.Label).string=t.nickname;var s=o.getChildByName("score").getComponent(cc.Label),n=0!=t.KVDataList.length?t.KVDataList[0].value:0;s.string=n.toString();var i=o.getChildByName("mask").children[0].getComponent(cc.Sprite);cc.loader.load({url:t.avatarUrl,type:"png"},function(e,t){e&&console.error(e),console.log(t),i.spriteFrame=new cc.SpriteFrame(t)})},hideRnakList:function(){this.display.active=!1,this.loadingLabel.active=!1,this.scoreText.active=!0},showRankList:function(){this.display.active=!0,this.scoreText.active=!1},_showUserData:function(e,t){var a=cc.instantiate(this.rankItem);a.parent=this.content;var o=a.getChildByName("nickName").getComponent(cc.Label),s=a.getChildByName("mask").children[0].getComponent(cc.Sprite);o.string=e,console.log(e+"'s info has been getten"),cc.loader.load({url:t,type:"png"},function(e,t){e&&console.error(e),console.log(t),s.spriteFrame=new cc.SpriteFrame(t)})}}),cc._RF.pop()},{}]},{},["rankList"]);