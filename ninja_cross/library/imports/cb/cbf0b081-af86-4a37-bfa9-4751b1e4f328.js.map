{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\script\\panel/assets\\script\\panel\\userInfo.js"],"names":["cc","Class","extends","Component","properties","nickName","Label","avatar","Sprite","onLoad","node","active","getUserInfo","e","Util","gameLog","start","_this","GameConfig","IS_WX","wx","getSystemInfo","success","res","systemInfo","system","brand","model","pixelRatio","screenWidth","screenHeight","version","platform","SDKVersion","benchmarkLevel","IS_AUTHORIZE","getSetting","authSetting","login","code","userInfo","avatarUrl","string","loader","load","err","texture","sprite","SpriteFrame","spriteFrame","width","height","console","log","auths_Btn","createUserInfoButton","type","image","style","left","Math","floor","top","onTap","res1","auths","hide","res2","request","url","INTER_URL","data","method","header","status","setStorageSync","sessionId","shareCode","sendUserInfo","error","show","fail","country","province","city","sex","gender","getStorageSync"],"mappings":";;;;;;AAAA;;;;AACA;;;;;;AACAA,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;AAELC,gBAAY;AACRC,kBAASL,GAAGM,KADJ;AAERC,gBAAOP,GAAGQ;AAFF,KAFP;AAMLC,UANK,oBAMK;AACN,aAAKC,IAAL,CAAUC,MAAV,GAAmB,KAAnB;AACA,YAAG;AAAE,iBAAKC,WAAL;AAAmB,SAAxB,CACA,OAAOC,CAAP,EAAU;AACNC,2BAAKC,OAAL,CAAa,CAAb,EAAe,UAAf;AACH;AACJ,KAZI;AAaLC,SAbK,mBAaI,CAAE,CAbN;;AAcL;AACAJ,eAfK,yBAeQ;AACT,YAAIK,QAAQ,IAAZ;AACA,YAAGC,qBAAWC,KAAd,EAAoB;AAChB;AACAC,eAAGC,aAAH,CAAiB;AACbC,uBADa,mBACJC,GADI,EACC;AACVL,yCAAWM,UAAX,CAAsBC,MAAtB,GAA+BF,IAAIE,MAAnC;AACAP,yCAAWM,UAAX,CAAsBE,KAAtB,GAA8BH,IAAIG,KAAlC;AACAR,yCAAWM,UAAX,CAAsBG,KAAtB,GAA8BJ,IAAII,KAAlC;AACAT,yCAAWM,UAAX,CAAsBI,UAAtB,GAAmCL,IAAIK,UAAvC;AACAV,yCAAWM,UAAX,CAAsBK,WAAtB,GAAoCN,IAAIM,WAAxC;AACAX,yCAAWM,UAAX,CAAsBM,YAAtB,GAAqCP,IAAIO,YAAzC;AACAZ,yCAAWM,UAAX,CAAsBO,OAAtB,GAAgCR,IAAIQ,OAApC;AACAb,yCAAWM,UAAX,CAAsBQ,QAAtB,GAAiCT,IAAIS,QAArC;AACAd,yCAAWM,UAAX,CAAsBS,UAAtB,GAAmCV,IAAIU,UAAvC;AACAf,yCAAWM,UAAX,CAAsBK,WAAtB,GAAoCN,IAAIM,WAAxC;AACAX,yCAAWM,UAAX,CAAsBU,cAAtB,GAAuCX,IAAIW,cAA3C;AACH;AAbY,aAAjB;AAeA,gBAAGhB,qBAAWiB,YAAX,IAA2B,KAA9B,EAAoC;AAChCf,mBAAGgB,UAAH,CAAc;AACVd,6BAAS,iBAASC,GAAT,EAAa;AAClB;AACA,4BAAIA,IAAIc,WAAJ,CAAgB,gBAAhB,CAAJ,EAAuC;AACnCpB,kCAAMP,IAAN,CAAWC,MAAX,GAAoB,IAApB;AACAO,iDAAWiB,YAAX,GAA0B,IAA1B;AACAf,+BAAGkB,KAAH,CAAS;AACLhB,uCADK,mBACGC,GADH,EACO;AACRL,yDAAWqB,IAAX,GAAkBhB,IAAIgB,IAAtB;AACA;AACAtB,0CAAMqB,KAAN;AACH;AALI,6BAAT;AAOA;AACAlB,+BAAGR,WAAH,CAAe;AACXU,yCAAS,iBAASC,GAAT,EAAa;AAClBL,yDAAWb,QAAX,GAAsBkB,IAAIiB,QAAJ,CAAanC,QAAnC;AACAa,yDAAWuB,SAAX,GAAuBlB,IAAIiB,QAAJ,CAAaC,SAAb,GAAuB,aAA9C;AACAxB,0CAAMZ,QAAN,CAAeqC,MAAf,GAAwBnB,IAAIiB,QAAJ,CAAanC,QAArC;AACAL,uCAAG2C,MAAH,CAAUC,IAAV,CAAe1B,qBAAWuB,SAA1B,EAAqC,UAAUI,GAAV,EAAeC,OAAf,EAAwB;AACzD,4CAAIC,SAAU,IAAI/C,GAAGgD,WAAP,CAAmBF,OAAnB,CAAd;AACA7B,8CAAMV,MAAN,CAAa0C,WAAb,GAA2BF,MAA3B;AACH,qCAHD;AAIH;AATU,6BAAf;AAWH;AACD;AAvBA,6BAwBI;AACA;AACA3B,mCAAGC,aAAH,CAAiB;AACbC,2CADa,mBACLC,GADK,EACD;AACR,4CAAI2B,QAAQ3B,IAAIM,WAAhB;AACA,4CAAIsB,SAAS5B,IAAIO,YAAjB;AACAsB,gDAAQC,GAAR,CAAYH,KAAZ,EAAkBC,MAAlB;AACA,4CAAGjC,qBAAWoC,SAAX,IAAwB,IAA3B,EAAgC;AAC5BpC,iEAAWoC,SAAX,GAAuBlC,GAAGmC,oBAAH,CAAwB;AAC3CC,sDAAM,OADqC;AAE3CC,uDAAO,oDAFoC;AAG3CC,uDAAO;AACHC,0DAAMT,QAAM,CAAN,GAAQ,EAAR,GAAWU,KAAKC,KAAL,CAAW,MAAIX,KAAJ,GAAU,GAArB,CADd;AAEHY,yDAAKX,SAAO,CAAP,GAAS,EAAT,GAAYS,KAAKC,KAAL,CAAW,MAAIV,MAAJ,GAAW,IAAtB,CAFd;AAGHD,2DAAM,EAHH;AAIHC,4DAAO;AAJJ;AAHoC,6CAAxB,CAAvB;AAUH;AACDjC,6DAAWoC,SAAX,CAAqBS,KAArB,CAA2B,UAACC,IAAD,EAAU;AACjC5C,+CAAGgB,UAAH,CAAc;AACVd,uDADU,mBACF2C,KADE,EACI;AACV,wDAAGA,MAAM5B,WAAN,CAAkB,gBAAlB,CAAH,EAAuC;AACnCe,gEAAQC,GAAR,CAAY,WAAZ;AACAnC,6EAAWiB,YAAX,GAA0B,IAA1B;AACAjB,6EAAWoC,SAAX,CAAqBY,IAArB;AACAjD,8DAAMP,IAAN,CAAWC,MAAX,GAAoB,IAApB;AACAS,2DAAGkB,KAAH,CAAS;AACLhB,mEADK,mBACG6C,IADH,EACQ;AACTjD,qFAAWqB,IAAX,GAAkB4B,KAAK5B,IAAvB;AACA;AACAnB,mEAAGgD,OAAH,CAAW;AACPC,yEAAInD,qBAAWoD,SAAX,GAAqB,OADlB;AAEPC,0EAAK;AACD,gFAAOrD,qBAAWqB;AADjB,qEAFE;AAKPiC,4EAAO,MALA;AAMPC,4EAAQ;AACJ,wFAAgB;AADZ,qEAND;AASPnD,6EAAQ,iBAAUC,GAAV,EAAe;AACnB6B,gFAAQC,GAAR,CAAY9B,IAAIgD,IAAhB;AACA,4EAAGhD,IAAIgD,IAAJ,CAASG,MAAT,IAAmB,CAAtB,EAAwB;AACpBtB,oFAAQC,GAAR,CAAY,MAAZ;AACAjC,+EAAGuD,cAAH,CAAkB,WAAlB,EAA8BpD,IAAIgD,IAAJ,CAASA,IAAT,CAAcK,SAA5C;AACAxD,+EAAGuD,cAAH,CAAkB,WAAlB,EAA8BpD,IAAIgD,IAAJ,CAASA,IAAT,CAAcM,SAA5C;AACA;AACA5D,kFAAM6D,YAAN;AACH,yEAND,MAOI;AACA,oFAAOvD,IAAIgD,IAAJ,CAAShC,IAAhB;AACI,qFAAK,IAAL;AACIa,4FAAQC,GAAR,CAAY,QAAZ;AACA;AACJ,qFAAK,IAAL;AACID,4FAAQC,GAAR,CAAY,QAAZ;AACA;AANR;AAQH;AACJ,qEA5BM;AA6BP0B,2EAAM,iBAAY;AACd3B,gFAAQC,GAAR,CAAY,MAAZ;AACH;AA/BM,iEAAX;AAiCH;AArCI,yDAAT;AAuCH,qDA5CD,MA6CI;AACAD,gEAAQC,GAAR,CAAY,WAAZ;AACH;AACJ;AAlDS,6CAAd;AAoDH,yCArDD;AAsDAnC,6DAAWoC,SAAX,CAAqB0B,IAArB;AACH;AAxEY,iCAAjB;AA0EH;AACJ,qBAxGS;AAyGVC,0BAAK,gBAAY;AACb7B,gCAAQC,GAAR,CAAY,QAAZ;AACH;AA3GS,iBAAd;AA6GH,aA9GD,MA+GI;AACA,qBAAK3C,IAAL,CAAUC,MAAV,GAAmB,IAAnB;AACA,oBAAGO,qBAAWoC,SAAd,EAAwB;AACpBpC,yCAAWoC,SAAX,CAAqBY,IAArB;AACH;AACD,qBAAK7D,QAAL,CAAcqC,MAAd,GAAuBxB,qBAAWb,QAAlC;AACAL,mBAAG2C,MAAH,CAAUC,IAAV,CAAe1B,qBAAWuB,SAA1B,EAAqC,UAAUI,GAAV,EAAeC,OAAf,EAAwB;AACzD,wBAAIC,SAAU,IAAI/C,GAAGgD,WAAP,CAAmBF,OAAnB,CAAd;AACA7B,0BAAMV,MAAN,CAAa0C,WAAb,GAA2BF,MAA3B;AACH,iBAHD;AAIH;AACJ;AACJ,KA7JI;;AA8JL;AACAT,SA/JK,mBA+JE;AACH,YAAIrB,QAAQ,IAAZ;AACAG,WAAGgD,OAAH,CAAW;AACPC,iBAAInD,qBAAWoD,SAAX,GAAqB,OADlB;AAEPC,kBAAK;AACD,wBAAOrD,qBAAWqB;AADjB,aAFE;AAKPiC,oBAAO,MALA;AAMPC,oBAAQ;AACJ,gCAAgB;AADZ,aAND;AASPnD,qBAAQ,iBAAUC,GAAV,EAAe;AACnB6B,wBAAQC,GAAR,CAAY9B,IAAIgD,IAAhB;AACA,oBAAGhD,IAAIgD,IAAJ,CAASG,MAAT,IAAmB,CAAtB,EAAwB;AACpBtB,4BAAQC,GAAR,CAAY,MAAZ;AACAjC,uBAAGuD,cAAH,CAAkB,WAAlB,EAA8BpD,IAAIgD,IAAJ,CAASA,IAAT,CAAcK,SAA5C;AACAxD,uBAAGuD,cAAH,CAAkB,WAAlB,EAA8BpD,IAAIgD,IAAJ,CAASA,IAAT,CAAcM,SAA5C;AACH,iBAJD,MAKI;AACA,4BAAOtD,IAAIgD,IAAJ,CAAShC,IAAhB;AACI,6BAAK,IAAL;AACIa,oCAAQC,GAAR,CAAY,QAAZ;AACA;AACA,6BAAK,IAAL;AACID,oCAAQC,GAAR,CAAY,QAAZ;AACA;AANZ;AAQH;AACA,aA1BE;AA2BP0B,mBAAM,iBAAY;AACd3B,wBAAQC,GAAR,CAAY,MAAZ;AACH;AA7BM,SAAX;AA+BH,KAhMI;;AAiML;AACAyB,gBAlMK,0BAkMS;AACV,YAAI7D,QAAQ,IAAZ;AACA;AACAG,WAAGR,WAAH,CAAe;AACXU,qBAAS,iBAASC,GAAT,EAAa;AAClBL,qCAAWb,QAAX,GAAsBkB,IAAIiB,QAAJ,CAAanC,QAAnC;AACAa,qCAAWuB,SAAX,GAAuBlB,IAAIiB,QAAJ,CAAaC,SAAb,GAAuB,aAA9C;AACAvB,qCAAWgE,OAAX,GAAqB3D,IAAIiB,QAAJ,CAAa0C,OAAlC;AACAhE,qCAAWiE,QAAX,GAAsB5D,IAAIiB,QAAJ,CAAa2C,QAAnC;AACAjE,qCAAWkE,IAAX,GAAkB7D,IAAIiB,QAAJ,CAAa4C,IAA/B;AACAlE,qCAAWmE,GAAX,GAAiB9D,IAAIiB,QAAJ,CAAa8C,MAA9B;AACArE,sBAAMZ,QAAN,CAAeqC,MAAf,GAAwBnB,IAAIiB,QAAJ,CAAanC,QAArC;AACAL,mBAAG2C,MAAH,CAAUC,IAAV,CAAe1B,qBAAWuB,SAA1B,EAAqC,UAAUI,GAAV,EAAeC,OAAf,EAAwB;AACzD,wBAAIC,SAAU,IAAI/C,GAAGgD,WAAP,CAAmBF,OAAnB,CAAd;AACA7B,0BAAMV,MAAN,CAAa0C,WAAb,GAA2BF,MAA3B;AACH,iBAHD;AAIA;AACA3B,mBAAGgD,OAAH,CAAW;AACPC,yBAAInD,qBAAWoD,SAAX,GAAqB,MADlB;AAEPC,0BAAK;AACD,oCAAWrD,qBAAWb,QADrB;AAED,mCAAUa,qBAAWuB,SAFpB;AAGD,mCAAUvB,qBAAWgE,OAHpB;AAID,oCAAWhE,qBAAWiE,QAJrB;AAKD,gCAAOjE,qBAAWkE,IALjB;AAMD,+BAAMlE,qBAAWmE;AANhB,qBAFE;AAUPb,4BAAO,MAVA;AAWPC,4BAAQ;AACJ,wCAAgB,mCADZ;AAEJ,kCAAS,aAAWrD,GAAGmE,cAAH,CAAkB,WAAlB;AAFhB,qBAXD;AAePjE,6BAAQ,iBAAUC,GAAV,EAAc;AAClB6B,gCAAQC,GAAR,CAAY9B,IAAIgD,IAAhB;AACA,4BAAGhD,IAAIgD,IAAJ,CAASG,MAAT,IAAmB,CAAtB,EAAwB;AACpBtB,oCAAQC,GAAR,CAAY,UAAZ;AACH,yBAFD,MAGI;AACA,oCAAO9B,IAAIgD,IAAJ,CAAShC,IAAhB;AACI,qCAAK,IAAL;AACIa,4CAAQC,GAAR,CAAY,YAAZ;AACJ,qCAAK,IAAL;AACID,4CAAQC,GAAR,CAAY,YAAZ;AAJR;AAMH;AACJ,qBA5BM;AA6BP0B,2BAAM,iBAAY;AACd3B,gCAAQC,GAAR,CAAY,QAAZ;AACH;AA/BM,iBAAX;AAiCH;AA/CU,SAAf;AAiDH;AAtPI;AAuPL;AAvPJ","file":"userInfo.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\panel","sourcesContent":["import GameConfig from '../gameConfig';\nimport Util from '../utils/util'\ncc.Class({\n    extends: cc.Component,\n    properties: {\n        nickName:cc.Label,\n        avatar:cc.Sprite\n    },\n    onLoad () {\n        this.node.active = false;\n        try{ this.getUserInfo()}\n        catch (e) {\n            Util.gameLog(1,'用户授权模块错误')\n        }\n    },\n    start () {},\n    //授权\n    getUserInfo(){\n        var _this = this;\n        if(GameConfig.IS_WX){\n            //获取用户系统信息\n            wx.getSystemInfo({\n                success (res) {\n                    GameConfig.systemInfo.system = res.system;\n                    GameConfig.systemInfo.brand = res.brand;\n                    GameConfig.systemInfo.model = res.model;\n                    GameConfig.systemInfo.pixelRatio = res.pixelRatio;\n                    GameConfig.systemInfo.screenWidth = res.screenWidth;\n                    GameConfig.systemInfo.screenHeight = res.screenHeight;\n                    GameConfig.systemInfo.version = res.version;\n                    GameConfig.systemInfo.platform = res.platform;\n                    GameConfig.systemInfo.SDKVersion = res.SDKVersion;\n                    GameConfig.systemInfo.screenWidth = res.screenWidth;\n                    GameConfig.systemInfo.benchmarkLevel = res.benchmarkLevel;\n                }\n            })\n            if(GameConfig.IS_AUTHORIZE == false){\n                wx.getSetting({\n                    success: function(res){\n                        //已经授权\n                        if (res.authSetting['scope.userInfo']) {\n                            _this.node.active = true;\n                            GameConfig.IS_AUTHORIZE = true;\n                            wx.login({\n                                success(res){\n                                    GameConfig.code = res.code;\n                                    //登陆服务器\n                                    _this.login();\n                                }\n                            })\n                            //获取用户信息\n                            wx.getUserInfo({\n                                success: function(res){\n                                    GameConfig.nickName = res.userInfo.nickName;\n                                    GameConfig.avatarUrl = res.userInfo.avatarUrl+'?aaa=aa.jpg';\n                                    _this.nickName.string = res.userInfo.nickName;\n                                    cc.loader.load(GameConfig.avatarUrl, function (err, texture) {\n                                        var sprite  = new cc.SpriteFrame(texture);\n                                        _this.avatar.spriteFrame = sprite;\n                                    });\n                                }\n                            })\n                        }\n                        //未授权\n                        else{\n                            //获取手机信息\n                            wx.getSystemInfo({\n                                success(res){\n                                    var width = res.screenWidth;\n                                    var height = res.screenHeight;\n                                    console.log(width,height)\n                                    if(GameConfig.auths_Btn == null){\n                                        GameConfig.auths_Btn = wx.createUserInfoButton({\n                                            type: 'image',\n                                            image: 'https://st.gwold.com/wfclb/ninja/pic/authorBtn.png',\n                                            style: {\n                                                left: width/2-40-Math.floor(250*width/750),\n                                                top: height/2-40-Math.floor(500*height/1206),\n                                                width:80,\n                                                height:80\n                                            }\n                                        })\n                                    }\n                                    GameConfig.auths_Btn.onTap((res1) => {\n                                        wx.getSetting({\n                                            success(auths){\n                                                if(auths.authSetting[\"scope.userInfo\"]){\n                                                    console.log(\"==已经授权===\")\n                                                    GameConfig.IS_AUTHORIZE = true;\n                                                    GameConfig.auths_Btn.hide();\n                                                    _this.node.active = true;\n                                                    wx.login({\n                                                        success(res2){\n                                                            GameConfig.code = res2.code;\n                                                            //登陆服务器\n                                                            wx.request({\n                                                                url:GameConfig.INTER_URL+\"login\",\n                                                                data:{\n                                                                    'code':GameConfig.code\n                                                                },\n                                                                method:\"POST\",\n                                                                header: {\n                                                                    'content-type': 'application/x-www-form-urlencoded'\n                                                                },\n                                                                success:function (res) {\n                                                                    console.log(res.data)\n                                                                    if(res.data.status == 1){\n                                                                        console.log(\"登陆成功\")\n                                                                        wx.setStorageSync('sessionId',res.data.data.sessionId)\n                                                                        wx.setStorageSync('shareCode',res.data.data.shareCode)\n                                                                        //将用户信息传至开发者服务器\n                                                                        _this.sendUserInfo();\n                                                                    }\n                                                                    else{\n                                                                        switch(res.data.code){\n                                                                            case 1006:\n                                                                                console.log(\"登录操作失败\")\n                                                                                break;\n                                                                            case 1005:\n                                                                                console.log(\"登录参数错误\")\n                                                                                break;\n                                                                        }\n                                                                    }\n                                                                },\n                                                                error:function () {\n                                                                    console.log(\"连接错误\")\n                                                                }\n                                                            })\n                                                        }\n                                                    })\n                                                }\n                                                else{\n                                                    console.log(\"==拒绝授权===\")\n                                                }\n                                            }\n                                        })\n                                    })\n                                    GameConfig.auths_Btn.show()\n                                }\n                            })\n                        }\n                    },\n                    fail:function () {\n                        console.log(\"调用接口失败\")\n                    }\n                })\n            }\n            else{\n                this.node.active = true;\n                if(GameConfig.auths_Btn){\n                    GameConfig.auths_Btn.hide();\n                }\n                this.nickName.string = GameConfig.nickName;\n                cc.loader.load(GameConfig.avatarUrl, function (err, texture) {\n                    var sprite  = new cc.SpriteFrame(texture);\n                    _this.avatar.spriteFrame = sprite;\n                });\n            }\n        }\n    },\n    //开发者服务器登录\n    login(){\n        var _this = this;\n        wx.request({\n            url:GameConfig.INTER_URL+\"login\",\n            data:{\n                'code':GameConfig.code\n            },\n            method:\"POST\",\n            header: {\n                'content-type': 'application/x-www-form-urlencoded'\n            },\n            success:function (res) {\n                console.log(res.data)\n                if(res.data.status == 1){\n                    console.log(\"登陆成功\");\n                    wx.setStorageSync('sessionId',res.data.data.sessionId);\n                    wx.setStorageSync('shareCode',res.data.data.shareCode)\n                }\n                else{\n                    switch(res.data.code){\n                        case 1006:\n                            console.log(\"登录操作失败\")\n                            break;\n                            case 1005:\n                                console.log(\"登录参数错误\")\n                                break;\n                    }\n                }\n                },\n            error:function () {\n                console.log(\"连接错误\")\n            }\n        })\n    },\n    //发送用户信息\n    sendUserInfo(){\n        var _this = this;\n        //获取用户信息\n        wx.getUserInfo({\n            success: function(res){\n                GameConfig.nickName = res.userInfo.nickName;\n                GameConfig.avatarUrl = res.userInfo.avatarUrl+'?aaa=aa.jpg';\n                GameConfig.country = res.userInfo.country;\n                GameConfig.province = res.userInfo.province;\n                GameConfig.city = res.userInfo.city;\n                GameConfig.sex = res.userInfo.gender;\n                _this.nickName.string = res.userInfo.nickName;\n                cc.loader.load(GameConfig.avatarUrl, function (err, texture) {\n                    var sprite  = new cc.SpriteFrame(texture);\n                    _this.avatar.spriteFrame = sprite;\n                });\n                //将用户信息传至开发者服务器\n                wx.request({\n                    url:GameConfig.INTER_URL+\"info\",\n                    data:{\n                        'nickName':GameConfig.nickName,\n                        'headImg':GameConfig.avatarUrl,\n                        'country':GameConfig.country,\n                        'province':GameConfig.province,\n                        'city':GameConfig.city,\n                        'sex':GameConfig.sex\n                    },\n                    method:\"POST\",\n                    header: {\n                        'content-type': 'application/x-www-form-urlencoded',\n                        'Cookie':\"SESSION=\"+wx.getStorageSync('sessionId')\n                    },\n                    success:function (res){\n                        console.log(res.data)\n                        if(res.data.status == 1){\n                            console.log(\"用户信息传送成功\")\n                        }\n                        else{\n                            switch(res.data.code){\n                                case 1006:\n                                    console.log(\"用户信息传送操作失败\")\n                                case 1005:\n                                    console.log(\"用户信息传送参数错误\")\n                            }\n                        }\n                    },\n                    error:function () {\n                        console.log(\"连接出现错误\")\n                    }\n                })\n            }\n        })\n    },\n    //获取分享信息\n});\n"]}