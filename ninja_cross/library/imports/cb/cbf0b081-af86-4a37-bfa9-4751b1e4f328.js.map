{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\script\\panel/assets\\script\\panel\\userInfo.js"],"names":["cc","Class","extends","Component","properties","nickName","Label","avatar","Sprite","onLoad","_this","node","active","login","unLoginedSetting","GameConfig","IS_AUTHORIZE","wx","getSetting","success","res","authSetting","console","log","loginWithWxAuthorize","getUserInfo","userInfo","avatarUrl","string","loader","load","err","texture","sprite","SpriteFrame","spriteFrame","loginWithoutWxAuthorize","getSystemInfo","width","screenWidth","height","screenHeight","auths_Btn","createUserInfoButton","type","image","style","left","Math","floor","top","onTap","errMsg","hide","director","getScene","children","getChildByName","sendUserInfo","fail","Util","gameLog","loginedSetting","request","url","INTER_URL","data","code","country","province","city","sex","enterShareConfig","enterShareCode","method","header","status","setStorageSync","sessionId","shareCode","getStorageSync","bestScore","info","error","getComponent","callBacks","callback","gender","haveCheckLogin","checkSession"],"mappings":"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","file":"userInfo.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\panel","sourcesContent":["import GameConfig from '../gameConfig';\r\nimport Util from '../utils/util'\r\ncc.Class({\r\n    extends: cc.Component,\r\n    properties: {\r\n        nickName: cc.Label,\r\n        avatar: cc.Sprite\r\n    },\r\n    onLoad() {\r\n        var _this = this\r\n        this.node.active = false;\r\n        this.login();\r\n    },\r\n    //未登陆处理\r\n    unLoginedSetting(){\r\n        var _this = this\r\n        if (GameConfig.IS_AUTHORIZE == false) {\r\n            wx.getSetting({\r\n                success: function (res) {\r\n                    //已经授权\r\n                    if (res.authSetting['scope.userInfo']) {\r\n                        console.log('==已获得登录权限==')\r\n                        _this.node.active = true;\r\n                        GameConfig.IS_AUTHORIZE = true;\r\n                        _this.loginWithWxAuthorize();\r\n                        //获取用户信息,显示头像\r\n                        wx.getUserInfo({\r\n                            success: function (res) {\r\n                                GameConfig.userInfo.nickName = res.userInfo.nickName;\r\n                                GameConfig.userInfo.avatarUrl = res.userInfo.avatarUrl + '?aaa=aa.jpg';\r\n                                _this.nickName.string = res.userInfo.nickName;\r\n                                cc.loader.load(GameConfig.userInfo.avatarUrl, function (err, texture) {\r\n                                    var sprite = new cc.SpriteFrame(texture);\r\n                                    _this.avatar.spriteFrame = sprite;\r\n                                });\r\n                            }\r\n                        })\r\n                    }\r\n                    //未授权\r\n                    else {\r\n                        _this.loginWithoutWxAuthorize();\r\n                        //获取手机信息\r\n                        wx.getSystemInfo({\r\n                            success(res) {\r\n                                var width = res.screenWidth;\r\n                                var height = res.screenHeight;\r\n                                console.log(width, height)\r\n                                if (GameConfig.auths_Btn == null) {\r\n                                    GameConfig.auths_Btn = wx.createUserInfoButton({\r\n                                        type: 'image',\r\n                                        image: 'https://st.gwold.com/wfclb/ninja/pic/authorBtn.png',\r\n                                        style: {\r\n                                            left: width / 2 - 30 - Math.floor(250 * width / 750),\r\n                                            top: height / 2 - 30 - Math.floor(500 * height / 1206),\r\n                                            width: 60,\r\n                                            height: 60\r\n                                        }\r\n                                    });\r\n                                    GameConfig.auths_Btn.onTap((res) => {\r\n                                        if (res.errMsg == \"getUserInfo:ok\") {\r\n                                            console.log(\"==已经授权===\")\r\n                                            GameConfig.IS_AUTHORIZE = true;\r\n                                            GameConfig.auths_Btn.hide();\r\n                                            var userInfo = cc.director.getScene().children[0].getChildByName(\"userInfo\");\r\n                                            userInfo.active = true\r\n                                            //将用户信息传至开发者服务器\r\n                                            _this.sendUserInfo();\r\n                                        }\r\n                                        else {\r\n                                            console.log(\"==拒绝授权===\")\r\n                                        }\r\n                                    })\r\n                                }\r\n                            }\r\n                        })\r\n                    }\r\n                },\r\n                fail: function () {\r\n                    Util.gameLog(\"wx.getSetting调用失败\")\r\n                }\r\n            })\r\n        }\r\n        else {\r\n            console.log(\"当前已手动授权\")\r\n            this.node.active = true;\r\n            if (GameConfig.auths_Btn) {\r\n                GameConfig.auths_Btn.hide();\r\n            }\r\n            this.nickName.string = GameConfig.userInfo.nickName;\r\n            cc.loader.load(GameConfig.userInfo.avatarUrl, function (err, texture) {\r\n                var sprite = new cc.SpriteFrame(texture);\r\n                _this.avatar.spriteFrame = sprite;\r\n            });\r\n        }\r\n    },\r\n    //已登陆处理\r\n    loginedSetting(){\r\n        var _this = this\r\n        if (GameConfig.IS_AUTHORIZE == false) {\r\n            wx.getSetting({\r\n                success: function (res) {\r\n                    //已经授权\r\n                    if (res.authSetting['scope.userInfo']) {\r\n                        console.log('==已获得登录权限==')\r\n                        _this.node.active = true;\r\n                        GameConfig.IS_AUTHORIZE = true;\r\n                        //获取用户信息,显示头像\r\n                        wx.getUserInfo({\r\n                            success: function (res) {\r\n                                GameConfig.userInfo.nickName = res.userInfo.nickName;\r\n                                GameConfig.userInfo.avatarUrl = res.userInfo.avatarUrl + '?aaa=aa.jpg';\r\n                                _this.nickName.string = res.userInfo.nickName;\r\n                                cc.loader.load(GameConfig.userInfo.avatarUrl, function (err, texture) {\r\n                                    var sprite = new cc.SpriteFrame(texture);\r\n                                    _this.avatar.spriteFrame = sprite;\r\n                                });\r\n                            }\r\n                        })\r\n                    }\r\n                    //未授权\r\n                    else {\r\n                        //获取手机信息\r\n                        wx.getSystemInfo({\r\n                            success(res) {\r\n                                var width = res.screenWidth;\r\n                                var height = res.screenHeight;\r\n                                console.log(width, height)\r\n                                if (GameConfig.auths_Btn == null) {\r\n                                    GameConfig.auths_Btn = wx.createUserInfoButton({\r\n                                        type: 'image',\r\n                                        image: 'https://st.gwold.com/wfclb/ninja/pic/authorBtn.png',\r\n                                        style: {\r\n                                            left: width / 2 - 30 - Math.floor(250 * width / 750),\r\n                                            top: height / 2 - 30 - Math.floor(500 * height / 1206),\r\n                                            width: 60,\r\n                                            height: 60\r\n                                        }\r\n                                    })\r\n                                    GameConfig.auths_Btn.onTap((res) => {\r\n                                        console.log('授权按钮点击返回值', res)\r\n                                        if (res.errMsg==\"getUserInfo:ok\") {\r\n                                            console.log(\"==已经授权===\")\r\n                                            GameConfig.IS_AUTHORIZE = true;\r\n                                            GameConfig.auths_Btn.hide();\r\n                                            var userInfo = cc.director.getScene().children[0].getChildByName(\"userInfo\");\r\n                                            userInfo.active = true\r\n                                            //将用户信息传至开发者服务器\r\n                                            _this.sendUserInfo();\r\n                                        }\r\n                                        else {\r\n                                            console.log(\"==拒绝授权===\")\r\n                                        }\r\n                                    })\r\n                                }\r\n                            }\r\n                        })\r\n                    }\r\n                },\r\n                fail: function () { }\r\n            })\r\n        }\r\n        else {\r\n            console.log(\"当前已手动授权\")\r\n            this.node.active = true;\r\n            if (GameConfig.auths_Btn) {\r\n                GameConfig.auths_Btn.hide();\r\n            }\r\n            this.nickName.string = GameConfig.userInfo.nickName;\r\n            cc.loader.load(GameConfig.userInfo.avatarUrl, function (err, texture) {\r\n                var sprite = new cc.SpriteFrame(texture);\r\n                _this.avatar.spriteFrame = sprite;\r\n            });\r\n        }\r\n    },\r\n    //微信已授权开发者服务器登录\r\n    loginWithWxAuthorize(){\r\n        console.log(\"已授权登陆开始\");\r\n        var _this = this;\r\n        this.getUserInfo(function () {\r\n            wx.request({\r\n                url: GameConfig.INTER_URL + \"login\",\r\n                data: {\r\n                    'code': GameConfig.userInfo.code,\r\n                    'nickName': GameConfig.userInfo.nickName,\r\n                    'headImg': GameConfig.userInfo.avatarUrl,\r\n                    'country': GameConfig.userInfo.country,\r\n                    'province': GameConfig.userInfo.province,\r\n                    'city': GameConfig.userInfo.city,\r\n                    'sex': GameConfig.userInfo.sex,\r\n                    'shareCode': GameConfig.enterShareConfig.enterShareCode\r\n                },\r\n                method: \"POST\",\r\n                header: {\r\n                    'content-type': 'application/x-www-form-urlencoded'\r\n                },\r\n                success: function (res) {\r\n                    console.log('微信已授权登陆完成后返回值：', res.data)\r\n                    if (res.data.status == 1) {\r\n                        wx.setStorageSync('sessionId', res.data.data.sessionId);\r\n                        wx.setStorageSync('shareCode', res.data.data.shareCode);\r\n                        //更新本地分数\r\n                        if (wx.getStorageSync('gameScore')) {\r\n                            if (res.data.data.bestScore > wx.getStorageSync('gameScore')) {\r\n                                wx.setStorageSync('gameScore', res.data.data.bestScore);\r\n                            }\r\n                        }\r\n                        else {\r\n                            wx.setStorageSync('gameScore', res.data.data.bestScore);\r\n                        }\r\n                    }\r\n                    else {\r\n                        console.log(res.data.info)\r\n                    }\r\n                },\r\n                error: function () {\r\n                    Util.gameLog(\"/login接口调用失败\")\r\n                }\r\n            })\r\n        })\r\n    },\r\n    //微信未授权开发者服务器登录\r\n    loginWithoutWxAuthorize(){\r\n        console.log(\"未授权登陆开始\");\r\n        var _this = this;\r\n        wx.request({\r\n            url: GameConfig.INTER_URL + \"login\",\r\n            data: {\r\n                'code': GameConfig.userInfo.code,\r\n                'shareCode': GameConfig.enterShareConfig.enterShareCode\r\n            },\r\n            method: \"POST\",\r\n            header: {\r\n                'content-type': 'application/x-www-form-urlencoded'\r\n            },\r\n            success: function (res) {\r\n                console.log('微信未授权登陆完成后返回值：', res.data)\r\n                if (res.data.status == 1) {\r\n                    wx.setStorageSync('sessionId', res.data.data.sessionId);\r\n                    wx.setStorageSync('shareCode', res.data.data.shareCode)\r\n                    //更新本地分数\r\n                    if (wx.getStorageSync('gameScore')) {\r\n                        if (res.data.data.bestScore > wx.getStorageSync('gameScore')) {\r\n                            wx.setStorageSync('gameScore', res.data.data.bestScore);\r\n                        }\r\n                    }\r\n                    else {\r\n                        wx.setStorageSync('gameScore', res.data.data.bestScore);\r\n                    }\r\n                }\r\n                else {\r\n                    Util.gameLog(res.data.info)\r\n                }\r\n            },\r\n            error: function () {\r\n                Util.gameLog(\"/login接口调用失败\")\r\n            }\r\n        })\r\n    },\r\n    //发送用户信息\r\n    sendUserInfo(){\r\n        console.log(\"将用户信息传送至开发者服务器开始\")\r\n        var _this = this;\r\n        var userInfo = cc.director.getScene().children[0].getChildByName(\"userInfo\");\r\n        var nickName = userInfo.getChildByName(\"nickName\").getComponent(cc.Label);\r\n        var avatar = userInfo.getChildByName(\"mask\").getChildByName(\"avatar\").getComponent(cc.Sprite);\r\n        this.getUserInfo(\r\n            function () {\r\n                nickName.string = GameConfig.userInfo.nickName;\r\n                cc.loader.load(GameConfig.userInfo.avatarUrl, function (err, texture) {\r\n                    var sprite = new cc.SpriteFrame(texture);\r\n                    avatar.spriteFrame = sprite;\r\n                });\r\n                //将用户信息传至开发者服务器\r\n                wx.request({\r\n                    url: GameConfig.INTER_URL + \"info\",\r\n                    data: {\r\n                        'nickName': GameConfig.userInfo.nickName,\r\n                        'headImg': GameConfig.userInfo.avatarUrl,\r\n                        'country': GameConfig.userInfo.country,\r\n                        'province': GameConfig.userInfo.province,\r\n                        'city': GameConfig.userInfo.city,\r\n                        'sex': GameConfig.userInfo.sex\r\n                    },\r\n                    method: \"POST\",\r\n                    header: {\r\n                        'content-type': 'application/x-www-form-urlencoded',\r\n                        'Cookie': \"SESSION=\" + wx.getStorageSync('sessionId')\r\n                    },\r\n                    success: function (res) {\r\n                        console.log(\"用户信息传至开发者服务器返回值\", res.data)\r\n                        if (res.data.status == 1){\r\n\r\n                        }\r\n                        else {\r\n                            Util.gameLog(res.data.info)\r\n                        }\r\n                    },\r\n                    error: function () {\r\n                        Util.gameLog(\"/info接口调用失败\")\r\n                    }\r\n                })\r\n            })\r\n    },\r\n    //获取用户信息\r\n    getUserInfo(callBacks) {\r\n        console.log(\"获取个人信息开始\")\r\n        var callback = callBacks;\r\n        wx.getUserInfo({\r\n            success: function (res) {\r\n                console.log(\"获取用户信息返回值\", res)\r\n                GameConfig.userInfo.nickName = res.userInfo.nickName;\r\n                GameConfig.userInfo.avatarUrl = res.userInfo.avatarUrl + '?aaa=aa.jpg';\r\n                GameConfig.userInfo.country = res.userInfo.country;\r\n                GameConfig.userInfo.province = res.userInfo.province;\r\n                GameConfig.userInfo.city = res.userInfo.city;\r\n                GameConfig.userInfo.sex = res.userInfo.gender;\r\n                if (res.userInfo.gender = '') {\r\n                    GameConfig.userInfo.sex = -1\r\n                }\r\n                callback && callback();\r\n            }\r\n        })\r\n    },\r\n    login() {\r\n        var _this = this;\r\n        if (!GameConfig.haveCheckLogin) {\r\n            wx.checkSession({\r\n                //session_key 未过期\r\n                success() {\r\n                    console.log(\"session_key未过期\")\r\n                    wx.request({\r\n                        url: GameConfig.INTER_URL + \"checkLogin\",\r\n                        method: \"POST\",\r\n                        header: {\r\n                            'content-type': 'application/x-www-form-urlencoded'\r\n                        },\r\n                        success: function (res) {\r\n                            console.log(res.data)\r\n                            GameConfig.haveCheckLogin = true;\r\n                            //已登录\r\n                            if (res.data.status == 1 && res.data.data == 1) {\r\n                                console.log(\"已登陆\")\r\n                                _this.loginedSetting()\r\n                            }\r\n                            //未登录\r\n                            else if (res.data.status == 1 && res.data.data == 0) {\r\n                                console.log(\"未登陆\")\r\n                                wx.login({\r\n                                    success(res) {\r\n                                        GameConfig.userInfo.code = res.code;\r\n                                        _this.unLoginedSetting();\r\n                                    }\r\n                                })\r\n                            }\r\n                        },\r\n                        fail: function () {\r\n                            Util.gameLog(\"checkLogin接口调用失败\")\r\n                        }\r\n                    })\r\n                },\r\n                //session_key 已过期\r\n                fail() {\r\n                    console.log(\"session_key已过期\")\r\n                    wx.login({\r\n                        success(res) {\r\n                            GameConfig.userInfo.code = res.code;\r\n                            GameConfig.haveCheckLogin = true;\r\n                            _this.unLoginedSetting();\r\n                        }\r\n                    })\r\n                }\r\n            })\r\n        }\r\n        else {\r\n            this.loginedSetting();\r\n        }\r\n    }\r\n});\r\n"]}