{"version":3,"sources":["..\\..\\..\\..\\assets\\script/assets\\script\\GameOver.js"],"names":["cc","Class","extends","Component","properties","playAgainBtn","Node","advBtn","navigateBtn","goBackHomeBtn","rankBtn","btnSound","AudioClip","bestScore","Label","nowScore","btnGroup","showOffbtn","showOffText","onLoad","_this","Util","btnEvent","game","reStartGame","node","active","GameUITools","loadingScene","loadingLayer","GameConfig","canResurrectTime","continueGame","IS_WX","wx","navigateToMiniProgram","appId","success","res","request","url","INTER_URL","data","env","header","getStorageSync","method","console","log","status","code","error","shareCode","GameDataManager","isBreakRecord","shareAppMessage","title","config","recordShareTitle","imageUrl","recordShareImg","query","passShareTitle","passShareImg","gameLog","loader","loadRes","err","prefab","instantiate","addChild","init","showScore","score","string","totalScore","setStorageSync","isHideSub","gameScore","postMessage","messageType","MAIN_MENU_NUM","gameId","e"],"mappings":"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","file":"GameOver.js","sourceRoot":"..\\..\\..\\..\\assets\\script","sourcesContent":["import Util from './utils/util' ;\r\nimport GameUITools from './utils/GameUITools';\r\nimport GameConfig from './gameConfig' ;\r\nimport GameDataManager from './GameDataManager';\r\ncc.Class({\r\n    extends: cc.Component,\r\n    properties: {\r\n        playAgainBtn:cc.Node,\r\n        advBtn:cc.Node,\r\n        navigateBtn:cc.Node,\r\n        goBackHomeBtn:cc.Node,\r\n        rankBtn:cc.Node,\r\n        btnSound:cc.AudioClip,\r\n        bestScore:cc.Label,\r\n        nowScore: cc.Label,\r\n        btnGroup:cc.Node,\r\n        showOffbtn:cc.Node,\r\n        showOffText:cc.Node,\r\n    },\r\n    onLoad () {\r\n        var _this = this;\r\n        //btn绑定事件\r\n        Util.btnEvent(this.playAgainBtn,this.btnSound,function () {\r\n            _this.game.reStartGame();\r\n            _this.node.active = false\r\n        });\r\n        Util.btnEvent(this.goBackHomeBtn,this.btnSound,function () {\r\n            GameUITools.loadingScene('start');\r\n        });\r\n        Util.btnEvent(this.rankBtn,this.btnSound,function () {\r\n            GameUITools.loadingLayer(\"panel/rank\")\r\n        });\r\n        Util.btnEvent(this.advBtn,this.btnSound,function () {\r\n            GameConfig.canResurrectTime -= 1;\r\n            _this.game.continueGame();\r\n            _this.node.active = false;\r\n        });\r\n        if(GameConfig.IS_WX){\r\n            Util.btnEvent(this.navigateBtn,this.btnSound,function (){\r\n                if(GameConfig.IS_WX){\r\n                    wx.navigateToMiniProgram({\r\n                        appId:'wx60dc6bacf553bdfc',\r\n                        success(res) {\r\n                            wx.request({\r\n                                url:GameConfig.INTER_URL+\"game/navigate\",\r\n                                data:{\r\n                                    'appId': 'wx60dc6bacf553bdfc',\r\n                                    'name': '忍者对对碰',\r\n                                    'path':'',\r\n                                    'extraData':'',\r\n                                    'env':GameConfig.env,\r\n                                },\r\n                                header:{\r\n                                    'content-type': 'application/x-www-form-urlencoded',\r\n                                    'Cookie':\"SESSION=\"+wx.getStorageSync('sessionId')\r\n                                },\r\n                                method: \"POST\",\r\n                                success:function (res){\r\n                                    console.log(\"跳转到其他小程序返回值\",res.data)\r\n                                    if(res.data.status == 1){\r\n                                        console.log(\"提交跳转信息成功\")\r\n                                    }\r\n                                    else{\r\n                                        switch(res.data.code){\r\n                                            case 1005:\r\n                                                console.log(\"提交跳转信息参数错误\")\r\n                                                break;\r\n                                        }\r\n                                    }\r\n                                },\r\n                                error:function () {\r\n                                    console.log(\"连接错误\")\r\n                                }\r\n                            })\r\n                        }\r\n                    })\r\n                }\r\n            });\r\n            Util.btnEvent(this.showOffbtn,this.btnSound,function (){\r\n                var shareCode = \"shareCode=\"+wx.getStorageSync('shareCode')\r\n                console.log(shareCode)\r\n                if(GameDataManager.isBreakRecord){\r\n                    console.log(\"破纪录的分享\")\r\n                    wx.shareAppMessage({\r\n                        title:GameConfig.config.recordShareTitle,\r\n                        imageUrl:GameConfig.config.recordShareImg,\r\n                        query:shareCode\r\n                    });\r\n                    wx.request({\r\n                        url:GameConfig.INTER_URL+\"game/share\",\r\n                        data:{\r\n                            'title': GameConfig.config.recordShareTitle,\r\n                            'image': GameConfig.config.recordShareImg,\r\n                            'query': wx.getStorageSync('shareCode')\r\n                        },\r\n                        header:{\r\n                            'content-type': 'application/x-www-form-urlencoded',\r\n                            'Cookie':\"SESSION=\"+wx.getStorageSync('sessionId')\r\n                        },\r\n                        method: \"POST\",\r\n                        success:function (res){\r\n                            console.log(res.data)\r\n                            if(res.data.status == 1){\r\n                                console.log(\"游戏分享保存成功\")\r\n                            }\r\n                            else{\r\n                                switch(res.data.code){\r\n                                    case 1005:\r\n                                        console.log(\"游戏分享保存参数错误\")\r\n                                        break;\r\n                                }\r\n                            }\r\n                        },\r\n                        error:function (){\r\n                            console.log(\"连接错误\")\r\n                        }\r\n\r\n                    })\r\n                }\r\n                else{\r\n                    console.log(\"未破纪录的分享\")\r\n                    wx.shareAppMessage({\r\n                        title:GameConfig.config.passShareTitle,\r\n                        imageUrl:GameConfig.config.passShareImg,\r\n                        query:shareCode\r\n                    });\r\n                    wx.request({\r\n                        url:GameConfig.INTER_URL+\"game/share\",\r\n                        data:{\r\n                            'title': GameConfig.config.passShareTitle,\r\n                            'image': GameConfig.config.passShareImg,\r\n                            'query': wx.getStorageSync('shareCode')\r\n                        },\r\n                        header: {\r\n                            'content-type': 'application/x-www-form-urlencoded',\r\n                            'Cookie':\"SESSION=\"+wx.getStorageSync('sessionId')\r\n                        },\r\n                        method: \"POST\",\r\n                        success:function (res){\r\n                            console.log(res.data)\r\n                            if(res.data.status == 1){\r\n                            }\r\n                            else{\r\n                                switch(res.data.code){\r\n                                    case 1005:\r\n                                        Util.gameLog(\"游戏分享保存参数错误\")\r\n                                        break;\r\n                                }\r\n                            }\r\n                        },\r\n                        error:function () {\r\n                            console.log(\"连接错误\")\r\n                        }\r\n\r\n                    });\r\n                }\r\n            });\r\n            cc.loader.loadRes(\"panel/subCanvas\", (err, prefab) => {\r\n                if(!err){\r\n                    let node = cc.instantiate(prefab);\r\n                    _this.node.addChild(node);\r\n                }\r\n            });\r\n        }\r\n    },\r\n    init:function(game){\r\n       this.game = game;\r\n    },\r\n    showScore:function(){\r\n        try{\r\n            if(GameConfig.IS_WX){\r\n            //分数记录\r\n            if (wx.getStorageSync('gameScore')) {\r\n                var score = wx.getStorageSync('gameScore');\r\n                this.nowScore.string = \"本次分值: \" + GameDataManager.totalScore;\r\n                if (GameDataManager.totalScore > score) {\r\n                    this.bestScore.string = \"历史最佳: \" + score;\r\n                    wx.setStorageSync('gameScore',GameDataManager.totalScore);\r\n                    this.showOffText.active = true;\r\n                    GameDataManager.isHideSub = true;\r\n                    GameDataManager.isBreakRecord = true;\r\n                }\r\n                else {\r\n                    this.showOffText.active = false;\r\n                    GameDataManager.isBreakRecord = false;\r\n                    this.bestScore.string = \"历史最佳: \" + score;\r\n                    GameDataManager.isHideSub = false;\r\n                }\r\n            }\r\n            else{\r\n                this.nowScore.string = \"本次分值: \" + GameDataManager.totalScore;\r\n                this.bestScore.string = \"历史最佳: \" + GameDataManager.totalScore;\r\n                wx.setStorageSync('gameScore',GameDataManager.totalScore);\r\n                GameDataManager.isHideSub = true;\r\n                GameDataManager.isBreakRecord = true;\r\n            }\r\n            //微信存储分数\r\n            var gameScore = GameDataManager.totalScore;\r\n            wx.postMessage({messageType: 1, score: gameScore, MAIN_MENU_NUM: GameConfig.MAIN_MENU_NUM,});\r\n            wx.postMessage({messageType: 3, MAIN_MENU_NUM: GameConfig.MAIN_MENU_NUM,});\r\n            if(GameDataManager.isHideSub){\r\n                wx.postMessage({messageType: 5});\r\n            }\r\n            //记录游戏数据\r\n            console.log(\"将要传回的gameID\",GameDataManager.gameId)\r\n            wx.request({\r\n                url:GameConfig.INTER_URL+\"game/over\",\r\n                data:{\r\n                    'gameId': GameDataManager.gameId,\r\n                    'score': GameDataManager.totalScore\r\n                },\r\n                header: {\r\n                    'content-type': 'application/x-www-form-urlencoded',\r\n                    'Cookie':\"SESSION=\"+wx.getStorageSync('sessionId')\r\n                },\r\n                method: \"POST\",\r\n                success:function (res) {\r\n                    console.log('游戏数据记录接口返回值：',res.data)\r\n                    if(res.data.status == 1){\r\n                    }\r\n                    else{\r\n                        switch(res.data.code){\r\n                            case 1004:\r\n                                Util.gameLog(\"游戏不存在\")\r\n                                break;\r\n                            case 1005:\r\n                                Util.gameLog(\"游戏数据记录参数错误\")\r\n                                break;\r\n                        }\r\n                    }\r\n                },\r\n                error:function () {\r\n                    Util.gameLog(\"/game/over接口调用失败\")\r\n                }\r\n            })\r\n        }}\r\n        catch (e) {\r\n            Util.gameLog('游戏结果显示模块错误')\r\n        }\r\n    }\r\n});\r\n"]}