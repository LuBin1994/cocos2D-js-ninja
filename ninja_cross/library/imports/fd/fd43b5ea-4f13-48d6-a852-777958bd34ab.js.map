{"version":3,"sources":["..\\..\\..\\..\\assets\\script/assets\\script\\GameOver.js"],"names":["cc","Class","extends","Component","properties","playAgainBtn","Node","advBtn","navigateBtn","goBackHomeBtn","rankBtn","btnSound","AudioClip","bestScore","Label","nowScore","btnGroup","showOffbtn","showOffText","onLoad","_this","loader","loadRes","err","prefab","node","instantiate","addChild","Util","btnEvent","GameConfig","canResurrectTime","active","game","reStartGame","GameUITools","loadingScene","loadingLayer","continueGame","IS_WX","wx","navigateToMiniProgram","appId","success","res","console","log","GameDataManager","isBreakRecord","shareAppMessage","title","config","recordShareTitle","imageUrl","recordShareImg","query","getStorageSync","onShareAppMessage","request","url","INTER_URL","data","header","method","status","code","error","shareTitle","shareImg","init","showScore","score","string","totalScore","setStorageSync","isHideSub","gameScore","postMessage","messageType","MAIN_MENU_NUM","gameId","e","gameLog"],"mappings":"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","file":"GameOver.js","sourceRoot":"..\\..\\..\\..\\assets\\script","sourcesContent":["import Util from './utils/util' ;\nimport GameUITools from './utils/GameUITools';\nimport GameConfig from './gameConfig' ;\nimport GameDataManager from './GameDataManager';\ncc.Class({\n    extends: cc.Component,\n    properties: {\n        playAgainBtn:cc.Node,\n        advBtn:cc.Node,\n        navigateBtn:cc.Node,\n        goBackHomeBtn:cc.Node,\n        rankBtn:cc.Node,\n        btnSound:cc.AudioClip,\n        bestScore:cc.Label,\n        nowScore: cc.Label,\n        btnGroup:cc.Node,\n        showOffbtn:cc.Node,\n        showOffText:cc.Node,\n    },\n    onLoad () {\n        var _this = this;\n        //btn绑定事件\n        cc.loader.loadRes(\"panel/subCanvas\", (err, prefab) => {\n            if(!err){\n                let node = cc.instantiate(prefab);\n                _this.node.addChild(node);\n            }\n        });\n        Util.btnEvent(this.playAgainBtn,this.btnSound,function () {\n            GameConfig.canResurrectTime = 1;\n            _this.advBtn.active = true;\n            _this.game.reStartGame();\n            _this.node.active = false\n        });\n        Util.btnEvent(this.goBackHomeBtn,this.btnSound,function () {\n            GameUITools.loadingScene('start');\n            GameConfig.canResurrectTime = 1;\n        });\n        Util.btnEvent(this.rankBtn,this.btnSound,function () {\n            GameUITools.loadingLayer(\"panel/rank\")\n        });\n        Util.btnEvent(this.advBtn,this.btnSound,function () {\n            GameConfig.canResurrectTime -= 1;\n            _this.game.continueGame();\n            _this.node.active = false;\n        });\n        Util.btnEvent(this.navigateBtn,this.btnSound,function (){\n            if(GameConfig.IS_WX){\n                wx.navigateToMiniProgram({\n                    appId:'wx60dc6bacf553bdfc',\n                    success(res) {\n                        console.log(\"跳转成功\")\n                    }\n                })\n            }\n        });\n        Util.btnEvent(this.showOffbtn,this.btnSound,function (){\n            if(GameConfig.IS_WX){\n                if(GameDataManager.isBreakRecord){\n                    wx.shareAppMessage({\n                        title:GameConfig.config.recordShareTitle,\n                        imageUrl:GameConfig.config.recordShareImg,\n                        query:\"SHARECODE=\"+wx.getStorageSync('shareCode')\n                    });\n                    //用户点击了“转发”按钮\n                    wx.onShareAppMessage(function (res) {\n                        return {\n                            title: GameConfig.config.recordShareTitle,\n                            imageUrl:GameConfig.config.recordShareImg,\n                            query:\"SHARECODE=\"+wx.getStorageSync('shareCode')\n                        }\n                    })\n                    wx.request({\n                        url:GameConfig.INTER_URL+\"game/share\",\n                        data:{\n                            'title': GameConfig.config.recordShareTitle,\n                            'image': GameConfig.config.recordShareImg,\n                            'query':\"SHARECODE=\"+wx.getStorageSync('shareCode')\n                        },\n                        header: {\n                            'content-type': 'application/x-www-form-urlencoded',\n                            'Cookie':\"SESSION=\"+wx.getStorageSync('sessionId')\n                        },\n                        method: \"POST\",\n                        success:function (res){\n                            console.log(res.data)\n                            if(res.data.status == 1){\n                                console.log(\"游戏分享保存成功\")\n                            }\n                            else{\n                                switch(res.data.code){\n                                    case 1005:\n                                        console.log(\"游戏分享保存参数错误\")\n                                        break;\n                                }\n                            }\n                        },\n                        error:function () {\n                            console.log(\"连接错误\")\n                        }\n\n                    })\n                }\n                else{\n                    wx.shareAppMessage({\n                        title:GameConfig.config.shareTitle,\n                        imageUrl:GameConfig.config.shareImg,\n                        query:\"SHARECODE=\"+wx.getStorageSync('shareCode')\n                    });\n                    wx.request({\n                        url:GameConfig.INTER_URL+\"game/share\",\n                        data:{\n                            'title': GameConfig.config.shareTitle,\n                            'image': GameConfig.config.shareImg,\n                            'query':\"SHARECODE=\"+wx.getStorageSync('shareCode')\n                        },\n                        header: {\n                            'content-type': 'application/x-www-form-urlencoded',\n                            'Cookie':\"SESSION=\"+wx.getStorageSync('sessionId')\n                        },\n                        method: \"POST\",\n                        success:function (res){\n                            console.log(res.data)\n                            if(res.data.status == 1){\n                                console.log(\"游戏分享保存成功\")\n                            }\n                            else{\n                                switch(res.data.code){\n                                    case 1005:\n                                        console.log(\"游戏分享保存参数错误\")\n                                        break;\n                                }\n                            }\n                        },\n                        error:function () {\n                            console.log(\"连接错误\")\n                        }\n\n                    });\n                    //用户点击了“转发”按钮\n                    wx.onShareAppMessage(function (res) {\n                        return {\n                            title: GameConfig.config.shareTitle,\n                            imageUrl:GameConfig.config.shareImg,\n                            query:\"SHARECODE=\"+wx.getStorageSync('shareCode')\n                        }\n                    })\n                }\n            }\n        });\n    },\n    init:function(game){\n       this.game = game;\n    },\n    showScore:function(){\n        try{if(GameConfig.IS_WX){\n            //分数记录\n            if (wx.getStorageSync('gameScore')) {\n                var score = wx.getStorageSync('gameScore');\n                this.nowScore.string = \"本次分值: \" + GameDataManager.totalScore;\n                if (GameDataManager.totalScore > score) {\n                    this.bestScore.string = \"历史最佳: \" + score;\n                    wx.setStorageSync('gameScore',GameDataManager.totalScore);\n                    this.showOffText.active = true;\n                    GameDataManager.isHideSub = true;\n                    GameDataManager.isBreakRecord = true;\n                }\n                else {\n                    this.showOffText.active = false;\n                    GameDataManager.isBreakRecord = false;\n                    this.bestScore.string = \"历史最佳: \" + score;\n                    GameDataManager.isHideSub = false;\n                }\n            }\n            else{\n                this.nowScore.string = \"本次分值: \" + GameDataManager.totalScore;\n                this.bestScore.string = \"历史最佳: \" + GameDataManager.totalScore;\n                wx.setStorageSync('gameScore',GameDataManager.totalScore);\n                GameDataManager.isHideSub = true;\n            }\n            //微信存储分数\n            var gameScore = GameDataManager.totalScore;\n            wx.postMessage({messageType: 1, score: gameScore, MAIN_MENU_NUM: GameConfig.MAIN_MENU_NUM,});\n            wx.postMessage({messageType: 3, MAIN_MENU_NUM: GameConfig.MAIN_MENU_NUM,});\n            if(GameDataManager.isHideSub){\n                wx.postMessage({messageType: 5});\n            }\n            //记录游戏数据\n            wx.request({\n                url:GameConfig.INTER_URL+\"game/over\",\n                data:{\n                    'gameId': GameDataManager.gameId,\n                    'score': GameDataManager.totalScore\n                },\n                header: {\n                    'content-type': 'application/x-www-form-urlencoded',\n                    'Cookie':\"SESSION=\"+wx.getStorageSync('sessionId')\n                },\n                method: \"POST\",\n                success:function (res) {\n                    console.log(res.data)\n                    if(res.data.status == 1){\n                        console.log(\"游戏数据记录成功\")\n                    }\n                    else{\n                        switch(res.data.code){\n                            case 1004:\n                                console.log(\"游戏不存在\")\n                                break;\n                            case 1005:\n                                console.log(\"游戏数据记录参数错误\")\n                                break;\n                        }\n                    }\n                },\n                error:function () {\n                    console.log(\"连接错误\")\n                }\n            })\n        }}\n        catch (e) {\n            Util.gameLog(1,'游戏结果显示模块错误')\n        }\n\n    }\n});\n"]}