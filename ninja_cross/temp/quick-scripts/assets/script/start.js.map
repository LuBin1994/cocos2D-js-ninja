{"version":3,"sources":["start.js"],"names":["cc","Class","extends","Component","properties","startBtn","Node","ruleBtn","rankBtn","modeChooseBtn","prefab","Prefab","btnSound","default","type","AudioClip","completeCount","totalCount","loadingMask","onLoad","init","GameConfig","IS_WX","wx","showShareMenu","getShareConfig","getUserSystemInfo","getOtherShareCode","start","director","preloadScene","console","log","tex","Texture2D","modeBounce","_this","GameUITools","initPrefab","haveLoadData","active","Util","btnEvent","loadingScene","loadingLayer","localStorage","getItem","request","url","INTER_URL","method","success","res","data","status","config","haveSetMode","GameDataManager","toolChoose","parseInt","defaultModel","gameDifficultyNum","difficulty","setGameDifficulty","onShareAppMessage","title","shareTitle","imageUrl","shareImg","query","getStorageSync","gameLog","info","getSystemInfo","systemInfo","system","brand","model","pixelRatio","screenWidth","screenHeight","version","platform","SDKVersion","benchmarkLevel","getLaunchOptionsSync","shareCode","enterShareConfig","enterShareCode","path","node","scale1","scaleTo","scale2","ani","sequence","ani1","repeatForever","runAction","update","dt"],"mappings":"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","file":"start.js","sourceRoot":"..\\..\\..\\..\\assets\\script","sourcesContent":["import Util from './utils/util';\r\nimport GameUITools from './utils/GameUITools';\r\nimport GameDataManager from './gameDataManager';\r\nimport GameConfig from './gameConfig';\r\ncc.Class({\r\n    extends: cc.Component,\r\n    properties: {\r\n        startBtn:cc.Node,\r\n        ruleBtn:cc.Node,\r\n        rankBtn:cc.Node,\r\n        modeChooseBtn:cc.Node,\r\n        prefab:[cc.Prefab],\r\n        btnSound:{\r\n            default: null,\r\n            type: cc.AudioClip\r\n        },\r\n        completeCount:0,\r\n        totalCount:2,\r\n        loadingMask:cc.Node\r\n    },\r\n    onLoad () {\r\n        this.init();\r\n        if(GameConfig.IS_WX){\r\n            wx.showShareMenu();//显示转发按钮\r\n            this.getShareConfig();\r\n            this.getUserSystemInfo();\r\n            this.getOtherShareCode();\r\n        }\r\n    },\r\n    start (){\r\n        cc.director.preloadScene(\"game\", () =>{\r\n           console.log(\"游戏场景已加载\");\r\n        });\r\n        this.tex = new cc.Texture2D();\r\n        this.modeBounce(this.startBtn);\r\n    },\r\n    init:function(){\r\n        var _this = this;\r\n        if(GameConfig.IS_WX){\r\n            //头像预制\r\n            GameUITools.initPrefab(this.prefab[1]);\r\n            if(GameConfig.haveLoadData){\r\n                this.loadingMask.active = false;\r\n            }\r\n            else{\r\n                this.loadingMask.active = true;\r\n            }\r\n        }\r\n        //音乐\r\n        GameUITools.initPrefab(this.prefab[0]);\r\n        //更多游戏\r\n        GameUITools.initPrefab(this.prefab[2]);\r\n        //开始游戏\r\n        Util.btnEvent(this.startBtn,this.btnSound,function(){\r\n            GameUITools.loadingScene(\"game\");\r\n        });\r\n        //弹出规则\r\n        Util.btnEvent(this.ruleBtn,this.btnSound,function(){\r\n            GameUITools.loadingLayer(\"panel/rule\");\r\n        });\r\n        //弹出排名\r\n        Util.btnEvent(this.rankBtn,this.btnSound,function(){\r\n            GameUITools.loadingLayer(\"panel/rank\");\r\n        });\r\n        //弹出模式选择\r\n        Util.btnEvent(this.modeChooseBtn,this.btnSound,function(){\r\n            GameUITools.loadingLayer(\"panel/modeChoose\")\r\n        });\r\n        if(!localStorage.getItem('modeGuide')){\r\n            GameUITools.loadingLayer(\"panel/modeChoose\");\r\n        }\r\n    },\r\n    //获取分享信息\r\n    getShareConfig() {\r\n        var _this = this\r\n        wx.request({\r\n            url: GameConfig.INTER_URL + \"game/getConfig\",\r\n            method: \"GET\",\r\n            success: function (res){\r\n                console.log(\"获取分享信息返回值：\",res.data)\r\n                if (res.data.status == 1){\r\n                    GameConfig.config = res.data.data;\r\n                    if(!GameConfig.haveSetMode){\r\n                        GameDataManager.toolChoose = parseInt(res.data.data.defaultModel)-1;\r\n                        GameConfig.haveSetMode = true\r\n                    }\r\n                    var gameDifficultyNum = parseInt(GameConfig.config.difficulty);\r\n                    //设置游戏难度\r\n                    Util.setGameDifficulty(gameDifficultyNum);\r\n                    _this.completeCount+=1;\r\n                    console.log('完成进度',_this.completeCount)\r\n                    //用户点击了右上角“转发”按钮\r\n                    wx.onShareAppMessage(function (res){\r\n                        return {\r\n                            title: GameConfig.config.shareTitle,\r\n                            imageUrl:GameConfig.config.shareImg,\r\n                            query:\"shareCode=\"+wx.getStorageSync('shareCode')\r\n                        }\r\n                    })\r\n                }\r\n                else {\r\n                    Util.gameLog(res.data.info)\r\n                }\r\n            }\r\n        })\r\n    },\r\n    //获取用户系统信息\r\n    getUserSystemInfo(){\r\n        var _this = this;\r\n        wx.getSystemInfo({\r\n            success (res){\r\n                GameConfig.systemInfo.system = res.system;\r\n                GameConfig.systemInfo.brand = res.brand;\r\n                GameConfig.systemInfo.model = res.model;\r\n                GameConfig.systemInfo.pixelRatio = res.pixelRatio;\r\n                GameConfig.systemInfo.screenWidth = res.screenWidth;\r\n                GameConfig.systemInfo.screenHeight = res.screenHeight;\r\n                GameConfig.systemInfo.version = res.version;\r\n                GameConfig.systemInfo.platform = res.platform;\r\n                GameConfig.systemInfo.SDKVersion = res.SDKVersion;\r\n                GameConfig.systemInfo.screenWidth = res.screenWidth;\r\n                GameConfig.systemInfo.benchmarkLevel = res.benchmarkLevel;\r\n                _this.completeCount+=1;\r\n                console.log('完成进度',_this.completeCount)\r\n            }\r\n        })\r\n    },\r\n    //获取由他人分享的shareCode\r\n    getOtherShareCode(){\r\n        var res = wx.getLaunchOptionsSync()\r\n        console.log(\"返回小程序启动参数\",res)\r\n        if(res.query.shareCode){\r\n            GameConfig.enterShareConfig.enterShareCode = res.query.shareCode;\r\n            GameConfig.enterShareConfig.path = res.path;\r\n        }\r\n    },\r\n    modeBounce(node){\r\n        var scale1 = cc.scaleTo(0.5,0.9)\r\n        var scale2 = cc.scaleTo(0.5,1)\r\n        var ani = cc.sequence(scale1,scale2);\r\n        var ani1 = cc.repeatForever(ani);\r\n        node.runAction(ani1);\r\n    },\r\n    update(dt){\r\n        if(!GameConfig.haveLoadData){\r\n            if(this.completeCount == this.totalCount){\r\n                console.log('已完成加载')\r\n                GameConfig.haveLoadData = true;\r\n                this.loadingMask.active = false; \r\n            }\r\n        }\r\n    },\r\n});\r\n"]}