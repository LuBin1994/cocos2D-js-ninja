{"version":3,"sources":["stage.js"],"names":["cc","Class","extends","Component","properties","stagePrefabs","doneStage","canRecycle","currentPlat","default","type","node","nextPlat","nextTwoPlat","currentPosX","nextPosX","nextTwoPosX","onLoad","_this","configInit","stagePrefabInit","stageInit","init","game","opacity","gameInit","destroyAll","callbacks","loader","loadRes","err","prefab","push","e","Util","gameLog","nextX","distance","centerDistance","instantiate","randomNum","setPosition","v2","parent","width","gameConfig","gameMoveSpeed","x","GameDataManager","toolChoose","stick","active","setStick","bridge","setBridge","energy","showCali","setCali","createStage","num1","num2","Math","floor","minMultiProbability","maxMultiProbability","chooseNum","setNextStage","num","stage","moveY","moveTo","fadeIn","ani","spawn","runAction","fog","showFog","recycleStage","removeChild","children","removeAllChildren","getLength","length","Object","minLength","maxLength","min","max","hideStage","showStage","setStagePosX","update","dt","isMove","childrens","i"],"mappings":"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","file":"stage.js","sourceRoot":"..\\..\\..\\..\\assets\\script","sourcesContent":["import gameConfig from './gameConfig' ;\r\nimport GameDataManager from './gameDataManager';\r\nimport Util from './utils/util' ;\r\ncc.Class({\r\n    extends: cc.Component,\r\n    properties: {\r\n        stagePrefabs: [],\r\n        doneStage: 0,//已通过的站台数\r\n        canRecycle: false,\r\n        currentPlat: {\r\n            default: null,\r\n            type: cc.node,\r\n        },\r\n        nextPlat: {\r\n            default: null,\r\n            type: cc.node,\r\n        },\r\n        nextTwoPlat: {\r\n            default: null,\r\n            type: cc.node,\r\n        },\r\n        currentPosX:0,\r\n        nextPosX:0,\r\n        nextTwoPosX:0,\r\n    },\r\n    onLoad() {\r\n        var _this = this;\r\n        this.configInit();\r\n        this.stagePrefabInit(function () { _this.stageInit(); });\r\n    },\r\n    init: function (game) {\r\n        this.game = game;\r\n    },\r\n    configInit:function(){\r\n        this.node.opacity = 255;\r\n        this.canRecycle = false;\r\n        this.doneStage = 0;\r\n    },\r\n    gameInit: function () {\r\n        this.destroyAll();\r\n        this.configInit();\r\n        this.stageInit();\r\n    },\r\n    //对象池，预制初始化\r\n    stagePrefabInit: function (callbacks) {\r\n        var _this = this;\r\n        try {\r\n            cc.loader.loadRes(\"stage/stage\" + 1, function (err, prefab) {\r\n                _this.stagePrefabs.push(prefab);\r\n                cc.loader.loadRes(\"stage/stage\" + 2, function (err, prefab) {\r\n                    _this.stagePrefabs.push(prefab);\r\n                    cc.loader.loadRes(\"stage/stage\" + 3, function (err, prefab) {\r\n                        _this.stagePrefabs.push(prefab);\r\n                        cc.loader.loadRes(\"stage/stage\" + 4, function (err, prefab) {\r\n                            _this.stagePrefabs.push(prefab);\r\n                            cc.loader.loadRes(\"stage/stage\" + 5, function (err, prefab) {\r\n                                _this.stagePrefabs.push(prefab);\r\n                                cc.loader.loadRes(\"stage/stage\" + 6, function (err, prefab) {\r\n                                    _this.stagePrefabs.push(prefab);\r\n                                    callbacks && callbacks();\r\n                                })\r\n                            })\r\n                        })\r\n                    })\r\n                })\r\n            })\r\n        }\r\n        catch (e) {\r\n            Util.gameLog(\"站桩预制加载出错\")\r\n        }\r\n    },\r\n    //站桩初始化\r\n    stageInit: function () {\r\n        var nextX,distance,centerDistance; \r\n        //第一个站桩\r\n        this.currentPlat = cc.instantiate(this.stagePrefabs[Util.randomNum(3)]);\r\n        this.currentPlat.setPosition(cc.v2(-230, -295));\r\n        this.currentPlat.parent = this.node;\r\n        this.currentPosX = -230\r\n        //第二个站桩\r\n        this.nextPlat = cc.instantiate(this.stagePrefabs[Util.randomNum(3)]);\r\n        distance = Util.randomNum(250)+100;//随机距离\r\n        centerDistance = distance + (this.currentPlat.width/2 + this.nextPlat.width/2)\r\n        centerDistance = centerDistance - centerDistance%gameConfig.gameMoveSpeed;//两站装中心距离设置为移动速度的整数倍，防止移动过程中出现的偏差\r\n        nextX = this.currentPlat.x+centerDistance;\r\n        this.nextPlat.setPosition(cc.v2(nextX, -295));\r\n        this.nextPlat.parent = this.node;\r\n        this.nextPosX = nextX;\r\n\r\n        //第三个站桩\r\n        this.nextTwoPlat = cc.instantiate(this.stagePrefabs[Util.randomNum(3)]);\r\n        distance = Util.randomNum(250)+100;//随机距离\r\n        centerDistance = distance + (this.nextPlat.width/2 + this.nextTwoPlat.width/2);\r\n        centerDistance = centerDistance - centerDistance%gameConfig.gameMoveSpeed;//两站装中心距离设置为移动速度的整数倍，防止移动过程中出现的偏差\r\n        nextX = this.nextPlat.x+centerDistance;\r\n        this.nextTwoPlat.setPosition(cc.v2(nextX, -295));\r\n        this.nextTwoPlat.parent = this.node;\r\n        this.nextTwoPosX = nextX;\r\n\r\n        //初始化设置道具\r\n        switch(GameDataManager.toolChoose){\r\n            case 0:\r\n                this.game.stick.node.active = true;\r\n                this.game.stick.setStick(this.currentPlat.x + this.currentPlat.width / 2);\r\n                break;\r\n            case 1:\r\n                this.game.bridge.node.active = true;\r\n                this.game.bridge.setBridge(this.currentPlat.x + this.currentPlat.width / 2);\r\n                break;\r\n            case 2:\r\n                this.game.energy.showCali();\r\n                this.game.energy.setCali();\r\n                break;\r\n        }\r\n    },\r\n    createStage: function () {\r\n        this.doneStage += 1;\r\n        var num1 = Util.randomNum(100);\r\n        var num2 = 100-Math.floor(this.doneStage/2)-gameConfig.minMultiProbability*100;\r\n        if(num2<100*(1-gameConfig.maxMultiProbability)){\r\n            num2 = 100*(1-gameConfig.maxMultiProbability);\r\n        }\r\n        var chooseNum = Util.randomNum(3);\r\n        if (num1 < num2) {   //抽取普通站台\r\n            this.setNextStage(chooseNum);\r\n        }\r\n        else {   //抽取多得分站台\r\n            if(GameDataManager.toolChoose == 1){\r\n                this.setNextStage(chooseNum + 2);\r\n            }\r\n            else{\r\n                this.setNextStage(chooseNum + 3);\r\n            }\r\n        }\r\n    },\r\n    //设置下一个站桩\r\n    setNextStage: function (num) {\r\n        var stage,nextX,distance,centerDistance;\r\n        this.currentPlat = this.nextPlat;\r\n        this.nextPlat = this.nextTwoPlat;\r\n        stage = cc.instantiate(this.stagePrefabs[num]);\r\n        this.nextTwoPlat = stage;\r\n        this.nextTwoPlat.parent = this.node;\r\n        this.nextTwoPlat.opacity = 0;\r\n        distance = Util.randomNum(250)+100;//随机距离\r\n        centerDistance = distance + (this.nextPlat.width/2 + this.nextTwoPlat.width/2);\r\n        centerDistance = centerDistance - centerDistance%gameConfig.gameMoveSpeed;//两站装中心距离设置为移动速度的整数倍，防止移动过程中出现的偏差\r\n        nextX = this.nextPlat.x + centerDistance;\r\n        this.nextTwoPlat.setPosition(cc.v2(nextX, -605));\r\n\r\n        //记录站桩位置，游戏继续可用\r\n        this.currentPosX = this.currentPlat.x;\r\n        this.nextPosX = this.nextPlat.x;\r\n        this.nextTwoPosX = this.nextTwoPlat.x;\r\n\r\n        //新生成的站台动画\r\n        var moveY = cc.moveTo(1,cc.v2(nextX,-295));\r\n        var fadeIn = cc.fadeIn(1);\r\n        var ani = cc.spawn(moveY,fadeIn);\r\n        this.nextTwoPlat.runAction(ani);\r\n\r\n        //选择下个道具\r\n        if(GameDataManager.toolChoose !== 2){\r\n            if(this.doneStage%5 == 0){\r\n                this.game.fog.showFog(this.nextPlat.x,-305)\r\n            }\r\n        }\r\n        if(GameDataManager.toolChoose == 2){\r\n            //设置能量条刻度\r\n            this.game.energy.setCali();\r\n        }\r\n    },\r\n    //游戏一回合结束删除经过的站桩\r\n    recycleStage: function () {\r\n        this.node.removeChild(this.node.children[0]);\r\n    },\r\n    //删除所有站桩\r\n    destroyAll:function(){\r\n        this.node.removeAllChildren(true);\r\n    },\r\n    //获取到下一个站桩的最小距离和最大距离\r\n    getLength(){\r\n        var length = new Object();\r\n        //道具搭桥成功所需的最小长度\r\n        var minLength = Math.floor((this.nextPlat.x - this.currentPlat.x) - (this.nextPlat.width + this.currentPlat.width)/2);\r\n        //道具搭桥成功所需的最大长度\r\n        var maxLength =Math.floor((this.nextPlat.x - this.currentPlat.x) + (this.nextPlat.width - this.currentPlat.width)/2);\r\n        length.min = minLength;\r\n        length.max = maxLength;\r\n        return length;\r\n    },\r\n    hideStage(){\r\n        this.node.opacity = 0;\r\n    },\r\n    showStage(){\r\n        this.node.opacity = 255;\r\n    },\r\n    //设置游戏复活站桩位置\r\n    setStagePosX(){\r\n        this.currentPlat.setPosition(cc.v2(this.currentPosX,-295));\r\n        this.nextPlat.setPosition(cc.v2(this.nextPosX,-295));\r\n        this.nextTwoPlat.setPosition(cc.v2(this.nextTwoPosX,-295));\r\n    },\r\n    update(dt) {\r\n        if (GameDataManager.isMove) {\r\n            //所有站桩左移\r\n            var childrens = this.node.children;\r\n            for (var i = 0; i < childrens.length; i++)\r\n            {\r\n                childrens[i].x -= gameConfig.gameMoveSpeed\r\n            }\r\n        }\r\n    },\r\n})\r\n\r\n"]}