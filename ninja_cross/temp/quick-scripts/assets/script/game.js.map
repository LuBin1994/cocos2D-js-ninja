{"version":3,"sources":["game.js"],"names":["Player","require","Stage","GameBg","Stick","GameOver","ScoreAni","Bridge","Fog","Energy","Shark","cc","Class","extends","Component","properties","player","stage","gameBg","stick","bridge","fog","gameOver","scoreAni","energy","scoreDisplay","Label","scoreGroup","Node","gameOverSound","AudioClip","shark","onLoad","init","Util","gameStartDataInit","configInit","node","opacity","runAction","fadeIn","_this","GameUITools","loadingLayer","gameConfig","IS_WX","on","isScreemCanTouch","GameDataManager","isAnimate","gameTouchStartProcessing","isStartLengthen","gameTouchEndProcessing","canShowGameOver","continueGame","setStagePosX","showStage","toolChoose","gameInit","x","currentPlat","width","setTool","gameContinueDataInit","string","totalScore","canResurrectTime","advBtn","active","reStartGame","loadingScene","wx","request","url","INTER_URL","header","getStorageSync","method","success","res","console","log","data","status","gameId","code","error","isLengthen","buildBridge","readyToJump","length","getToolLength","moveDistance","Math","floor","distance","height","successOrlose","isShowFog","hideFog","lengthObj","getLength","min","max","culculateScore","isSuccess","isGameOver","Animation","toolRotateAni","setTimeout","run","successJump","jumpHeight","failJump","toolLength","scoreInterval","num","parseInt","nextPlat","name","replace","centerDistance","abs","nextScore","addScoreGrade","allMove","callbacks","move","gameMoveSpeed","bridgeY","setStick","setBridge","stop","gainScore","showGameOver","showScore","audioEngine","playEffect","scheduleOnce","hideStage","navigateBtn","update","dt","isMove","createStage","recycleStage","showScoreFx","canDrop","drop"],"mappings":"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","file":"game.js","sourceRoot":"..\\..\\..\\..\\assets\\script","sourcesContent":["import Util from './utils/util' ;\nimport Animation from './utils/animation';\nimport GameUITools from './utils/GameUITools';\nimport gameConfig from './gameConfig' ;\nimport GameDataManager from './gameDataManager';\nvar Player = require('player');\nvar Stage = require('stage');\nvar GameBg = require('gameBg');\nvar Stick = require('stick');\nvar GameOver = require('GameOver');\nvar ScoreAni = require('scoreAni');\nvar Bridge = require('bridge');\nvar Fog = require('fog');\nvar Energy = require('energy');\nvar Shark = require('shark');\ncc.Class({\n    extends: cc.Component,\n    properties: {\n        player: Player,\n        stage: Stage,\n        gameBg: GameBg,\n        stick: Stick,\n        bridge:Bridge,\n        fog:Fog,\n        gameOver:GameOver,\n        scoreAni:ScoreAni,\n        energy:Energy,\n        scoreDisplay:cc.Label,\n        scoreGroup:cc.Node,\n        gameOverSound:cc.AudioClip,\n        shark:Shark,\n    },\n    onLoad() {\n        this.gameBg.init(this);\n        this.stage.init(this);\n        this.gameOver.init(this);\n        this.energy.init(this);\n        this.shark.init(this);\n        this.player.init(this);\n        Util.gameStartDataInit();\n        this.init();\n        this.configInit();\n        this.node.opacity = 0;\n        this.node.runAction(cc.fadeIn(0.5));\n    },\n    init: function () {\n        var _this = this;\n        GameUITools.loadingLayer(\"panel/music\");\n        if(gameConfig.IS_WX){\n            GameUITools.loadingLayer(\"panel/userInfo\");\n        }\n        this.node.on('touchstart', function () {\n            if(gameConfig.isScreemCanTouch && !GameDataManager.isAnimate){\n                _this.gameTouchStartProcessing();\n            }\n        });\n        this.node.on('touchend', function () {\n            if(gameConfig.isScreemCanTouch){\n                if ( GameDataManager.isStartLengthen) {\n                    _this.gameTouchEndProcessing();\n                }\n            }\n        });\n    },\n    configInit: function () {\n        this.canShowGameOver = true\n    },\n    //游戏复活\n    continueGame: function () {\n        this.stage.setStagePosX();\n        this.stage.showStage();\n        switch(GameDataManager.toolChoose){\n            case 0:\n                this.stick.gameInit();\n                break;\n            case 1:\n                this.bridge.gameInit();\n                break;\n            case 2:\n                break;\n        }\n        this.stick.node.x = this.stage.currentPlat.x + this.stage.currentPlat.width / 2;\n        this.player.gameInit();\n        this.shark.gameInit();\n        this.setTool();\n        Util.gameContinueDataInit();\n        this.configInit();\n        this.scoreDisplay.string = GameDataManager.totalScore;\n        if(gameConfig.canResurrectTime == 0){\n            this.gameOver.advBtn.active = false;\n        }\n        if(GameDataManager.toolChoose == 2){\n            this.energy.gameInit();\n        }\n        this.scoreGroup.opacity = 255;\n    },\n    //重开游戏\n    reStartGame: function () {\n        GameUITools.loadingScene(\"game\");\n        if(gameConfig.IS_WX){\n            //游戏开始获取gameId\n            wx.request({\n                url:gameConfig.INTER_URL+\"game/start\",\n                header: {\n                    'Cookie':\"SESSION=\"+wx.getStorageSync('sessionId')\n                },\n                method: \"POST\",\n                success:function (res) {\n                    console.log(res.data)\n                    if(res.data.status == 1){\n                        GameDataManager.gameId = res.data.data\n                    }\n                    else{\n                        switch(res.data.code){\n                            case 1006:\n                                console.log(\"游戏开始操作失败\")\n                                break;\n                        }\n                    }\n                },\n                error:function () {\n                    console.log(\"连接错误\")\n                }\n            });\n        }\n    },\n    /**\n     * 游戏触摸开始数据处理\n     */\n    gameTouchStartProcessing(){\n        if(!GameDataManager.isAnimate){\n            GameDataManager.isLengthen = true;\n            GameDataManager.isStartLengthen = true;\n            switch(GameDataManager.toolChoose){\n                case 1:\n                    this.bridge.buildBridge();\n                    break;\n                case 2:\n                    this.player.readyToJump();\n                    break;\n            }\n        }\n    },\n    /**\n     * 游戏触摸结束数据处理\n     */\n    gameTouchEndProcessing(){\n        GameDataManager.isLengthen = false;\n        if(!GameDataManager.isAnimate){\n            var length = this.getToolLength();\n            if(GameDataManager.toolChoose <= 1){\n                GameDataManager.moveDistance =Math.floor(this.stage.currentPlat.x - this.player.node.x + length + this.stage.currentPlat.width/2)\n            }\n            else{\n                var distance = Math.floor(this.energy.energy.height/300*600);\n                GameDataManager.moveDistance =Math.floor(this.stage.currentPlat.x - this.player.node.x + distance + this.stage.currentPlat.width/2)\n            }\n            this.successOrlose(length);\n            if(GameDataManager.isShowFog){\n                this.fog.hideFog();\n            }\n            GameDataManager.isAnimate = true;\n        }\n    },\n    /**\n     * 计算道具是否能完成过桥\n     */\n    successOrlose: function (length) {\n        var _this = this;\n        var lengthObj = this.stage.getLength();\n        //判断搭桥是否成功\n        if (lengthObj.min <= length && length <= lengthObj.max){\n            this.culculateScore(length,lengthObj.min);\n            GameDataManager.isSuccess = true\n        }\n        else {\n            GameDataManager.isSuccess = false\n        }\n\n        //道具执行动画\n        if(!GameDataManager.isGameOver){\n            switch(GameDataManager.toolChoose){\n                case 0:\n                    //棍子执行动画\n                    Animation.toolRotateAni( GameDataManager.isSuccess,this.stick.node);\n                    setTimeout(function () { _this.player.run()},700);\n                    break;\n                case 1:\n                    //桥执行动画\n                    Animation.toolRotateAni( GameDataManager.isSuccess,this.bridge.node);\n                    setTimeout(function () { _this.player.run() },700);\n                    break;\n                case 2:\n                    //跳跃执行动画\n                    if(GameDataManager.isSuccess){\n                        this.player.successJump(GameDataManager.moveDistance,_this.player.jumpHeight);\n                    }\n                    else{\n                        this.player.failJump(GameDataManager.moveDistance,_this.player.jumpHeight);\n                    }\n                    break;\n            }\n        }\n    },\n    /**\n     * 得分计算\n     * @param toolLength 道具长度\n     * @param distance 站桩距离\n     */\n    culculateScore:function(toolLength,distance){\n        var scoreInterval; //得分区间\n        var num = parseInt(this.stage.nextPlat.name.replace(/[^0-9]/ig, \"\"));\n        var centerDistance = Math.floor(Math.abs(toolLength-( distance + this.stage.nextPlat.width/2))); //道具顶点与下个站桩中心的距离\n        if(num <= 3){\n            scoreInterval = Math.floor(this.stage.nextPlat.width/9);\n            if(0 <= centerDistance && centerDistance <= 0.5*scoreInterval){\n                GameDataManager.nextScore = 5;\n                GameDataManager.addScoreGrade = 3;\n            }\n            else if(0.5*scoreInterval < centerDistance && centerDistance <= 1.5*scoreInterval){\n                GameDataManager.nextScore = 4;\n                GameDataManager.addScoreGrade = 2;\n            }\n            else if(1.5*scoreInterval < centerDistance && centerDistance <= 2.5*scoreInterval){\n                GameDataManager.nextScore = 3;\n                GameDataManager.addScoreGrade = 2;\n            }\n            else if(2.5*scoreInterval < centerDistance && centerDistance <= 3.5*scoreInterval){\n                GameDataManager.nextScore = 2;\n                GameDataManager.addScoreGrade = 1;\n            }\n            else if(3.5*scoreInterval < centerDistance && centerDistance <= 4.5*scoreInterval){\n                GameDataManager.nextScore = 1;\n                GameDataManager.addScoreGrade = 1;\n            }\n        }\n        else{\n            switch(num){\n                case 4:\n                    scoreInterval = Math.floor(this.stage.nextPlat.width/7);\n                    if(0 < centerDistance && centerDistance <= 0.5*scoreInterval){\n                        GameDataManager.nextScore = 6;\n                        GameDataManager.addScoreGrade = 3;\n                    }\n                    else if(0.5*scoreInterval <centerDistance && centerDistance <= 1.5*scoreInterval){\n                        GameDataManager.nextScore = 5;\n                        GameDataManager.addScoreGrade = 2;\n                    }\n                    else if(1.5*scoreInterval <centerDistance && centerDistance <= 2.5*scoreInterval){\n                        GameDataManager.nextScore = 3;\n                        GameDataManager.addScoreGrade = 2;\n                    }\n                    else if(2.5*scoreInterval <centerDistance && centerDistance <= 3.5*scoreInterval){\n                        GameDataManager.nextScore = 1;\n                        GameDataManager.addScoreGrade = 1;\n                    }\n                    break;\n                case 5:\n                    scoreInterval = Math.floor(this.stage.nextPlat.width/5);\n                    if(0 < centerDistance && centerDistance <= 0.5*scoreInterval){\n                        GameDataManager.nextScore = 7;\n                        GameDataManager.addScoreGrade = 3;\n                    }\n                    else if(0.5*scoreInterval <centerDistance && centerDistance <= 1.5*scoreInterval){\n                        GameDataManager.nextScore = 4;\n                        GameDataManager.addScoreGrade = 2;\n                    }\n                    else if(1.5*scoreInterval <centerDistance && centerDistance <= 2.5*scoreInterval){\n                        GameDataManager.nextScore = 2;\n                        GameDataManager.addScoreGrade = 1;\n                    }\n                    break;\n                case 6:\n                    scoreInterval = Math.floor(this.stage.nextPlat.width/3);\n                    if(0 < centerDistance && centerDistance <= 0.5*scoreInterval){\n                        GameDataManager.nextScore = 8;\n                        GameDataManager.addScoreGrade = 3;\n                    }\n                    else if(0.5*scoreInterval <centerDistance && centerDistance <= 1.5*scoreInterval){\n                        GameDataManager.nextScore = 4;\n                        GameDataManager.addScoreGrade = 2;\n                    }\n                    break;\n            }\n        }\n    },\n    /**\n     * 控制所有节点的移动\n     */\n    allMove: function (callbacks){\n        GameDataManager.move += gameConfig.gameMoveSpeed;\n        if (GameDataManager.move > (GameDataManager.moveDistance)) {\n            callbacks && callbacks();  //移动完执行\n        }\n    },\n    /**\n     * 获取道具长度\n     */\n    getToolLength:function(){\n        switch(GameDataManager.toolChoose){\n            case 0:\n                return this.stick.node.height;\n                break;\n            case 1:\n                return this.bridge.bridgeY;\n                break;\n            case 2:\n                return Math.floor(this.energy.energy.height/300*600);\n                break;\n        }\n    },\n    /**\n     * 设置道具\n     */\n    setTool:function(){\n        switch(GameDataManager.toolChoose){\n            case 0:\n                this.stick.setStick(this.stage.currentPlat.x + this.stage.currentPlat.width / 2)\n                break;\n            case 1:\n                this.bridge.setBridge(this.stage.currentPlat.x + this.stage.currentPlat.width / 2);\n                break;\n            case 2:\n                this.player.stop();\n                break;\n        }\n    },\n    //得分\n    gainScore: function () {\n        GameDataManager.totalScore += GameDataManager.nextScore;\n        this.scoreDisplay.string = GameDataManager.totalScore;\n    },\n    /**\n     * 游戏结束显示\n     */\n    showGameOver: function () {\n        var _this = this;\n        if (this.canShowGameOver) {\n            GameDataManager.isGameOver = true;\n            this.gameOver.showScore();\n            cc.audioEngine.playEffect(_this.gameOverSound,false,1);\n            this.scheduleOnce(function() {\n                switch(GameDataManager.toolChoose){\n                    case 0:\n                        this.stick.node.opacity = 0;\n                        break;\n                    case 1:\n                        this.bridge.node.opacity = 0;\n                        break;\n                    case 2:\n                        this.energy.node.opacity = 0;\n                        break;\n                }\n                this.scoreGroup.opacity = 0;\n                this.gameOver.node.active = true;\n                this.stage.hideStage();\n            }, 1.5);\n            this.fog.hideFog();\n            if(gameConfig.canResurrectTime == 0){\n                this.gameOver.advBtn.active = false;\n                this.gameOver.navigateBtn.active = true;\n                //this.gameOver.btnGroup.y = -270;\n            }\n            else{\n                this.gameOver.advBtn.active = true;\n                this.gameOver.navigateBtn.active = false\n                //this.gameOver.btnGroup.y = -390;\n            }\n        }\n        this.canShowGameOver = false;\n    },\n    update(dt) {\n        var _this = this;\n        if (GameDataManager.isAnimate) {\n            //所有对象移动，以及移动完的回调\n            if (GameDataManager.isMove) {\n                if(GameDataManager.isSuccess){\n                    this.allMove(function () {\n                        if(GameDataManager.isSuccess){\n                            GameDataManager.isMove = false;\n                            GameDataManager.isAnimate = false;\n                            GameDataManager.move = 0;\n                            _this.stage.createStage();\n                            _this.stage.recycleStage();\n                            if(GameDataManager.toolChoose !== 2){\n                                _this.gainScore();\n                                _this.scoreAni.showScoreFx();\n                            }\n                            _this.setTool();\n                            _this.player.stop();\n                            if(GameDataManager.toolChoose == 2){\n                                _this.energy.configInit();\n                            }\n                            GameDataManager.isStartLengthen = false;\n                        }\n                    });\n                }\n            }\n            //人物掉落动画\n            if (!GameDataManager.isSuccess) {\n                if (GameDataManager.canDrop) {\n                    var moveDistance = this.stage.currentPlat.x-this.player.node.x+this.stage.currentPlat.width/2\n                    this.player.drop(moveDistance);\n                    this.showGameOver();\n                    GameDataManager.canDrop = false;\n                }\n            }\n        }\n    }\n});\n\n"]}