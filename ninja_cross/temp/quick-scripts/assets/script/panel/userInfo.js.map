{"version":3,"sources":["userInfo.js"],"names":["cc","Class","extends","Component","properties","nickName","Label","avatar","Sprite","onLoad","node","active","getUserInfoNew","start","_this","GameConfig","IS_AUTHORIZE","wx","getSetting","success","res","authSetting","login","code","fail","console","log","getUserInfo","userInfo","avatarUrl","string","loader","load","err","texture","sprite","SpriteFrame","spriteFrame","IS_AUTHS_OPE","getSystemInfo","width","screenWidth","height","screenHeight","auths_Btn","createUserInfoButton","type","text","style","left","top","lineHeight","backgroundColor","color","textAlign","fontSize","borderRadius","onTap","res1","auths","hide","res2","withCredentials","lang","res3","show"],"mappings":";;;;;;AAAA;;;;;;AACAA,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;AAELC,gBAAY;AACRC,kBAASL,GAAGM,KADJ;AAERC,gBAAOP,GAAGQ;AAFF,KAFP;AAMLC,UANK,oBAMK;AACN,aAAKC,IAAL,CAAUC,MAAV,GAAmB,KAAnB;AACA,aAAKC,cAAL;AACH,KATI;AAULC,SAVK,mBAUI,CAAE,CAVN;;AAWL;AACAD,kBAZK,4BAYW;AACZ,YAAIE,QAAQ,IAAZ;AACA,YAAGC,qBAAWC,YAAX,IAA2B,KAA9B,EAAoC;AAChCC,eAAGC,UAAH,CAAc;AACVC,yBAAS,iBAASC,GAAT,EAAa;AAClB;AACA,wBAAIA,IAAIC,WAAJ,CAAgB,gBAAhB,CAAJ,EAAuC;AACnCP,8BAAMJ,IAAN,CAAWC,MAAX,GAAoB,IAApB;AACAI,6CAAWC,YAAX,GAA0B,IAA1B;AACAC,2BAAGK,KAAH,CAAS;AACLH,mCADK,mBACGC,GADH,EACO;AACRL,qDAAWQ,IAAX,GAAkBH,IAAIG,IAAtB;AACD;;;;;;;;;;;;;;;;;;;;;AAqBF,6BAxBI;AAyBLC,gCAzBK,kBAyBC;AACFC,wCAAQC,GAAR,CAAY,QAAZ;AACH;AA3BI,yBAAT;AA6BA;AACAT,2BAAGU,WAAH,CAAe;AACXR,qCAAS,iBAASC,GAAT,EAAa;AAClBL,qDAAWV,QAAX,GAAsBe,IAAIQ,QAAJ,CAAavB,QAAnC;AACAU,qDAAWc,SAAX,GAAuBT,IAAIQ,QAAJ,CAAaC,SAAb,GAAuB,aAA9C;AACAf,sCAAMT,QAAN,CAAeyB,MAAf,GAAwBV,IAAIQ,QAAJ,CAAavB,QAArC;AACAL,mCAAG+B,MAAH,CAAUC,IAAV,CAAejB,qBAAWc,SAA1B,EAAqC,UAAUI,GAAV,EAAeC,OAAf,EAAwB;AACzD,wCAAIC,SAAU,IAAInC,GAAGoC,WAAP,CAAmBF,OAAnB,CAAd;AACApB,0CAAMP,MAAN,CAAa8B,WAAb,GAA2BF,MAA3B;AACH,iCAHD;AAIH;AATU,yBAAf;AAWH;AACD;AA7CA,yBA8CI;AACA;AACA,gCAAG,CAACpB,qBAAWuB,YAAf,EAA4B;AACxB;AACArB,mCAAGsB,aAAH,CAAiB;AACbpB,2CADa,mBACLC,GADK,EACD;AACR,4CAAIoB,QAAQpB,IAAIqB,WAAhB;AACA,4CAAIC,SAAStB,IAAIuB,YAAjB;AACA5B,6DAAW6B,SAAX,GAAuB3B,GAAG4B,oBAAH,CAAwB;AAC3CC,kDAAM,MADqC;AAE3CC,kDAAM,MAFqC;AAG3CC,mDAAO;AACHC,sDAAM,CAACT,QAAM,GAAP,IAAY,CADf;AAEHU,qDAAK,CAACR,SAAO,GAAR,IAAa,CAAb,GAAe,EAFjB;AAGHF,uDAAM,GAHH;AAIHE,wDAAQ,GAJL;AAKHS,4DAAY,GALT;AAMHC,iEAAiB,SANd;AAOHC,uDAAO,SAPJ;AAQHC,2DAAW,QARR;AASHC,0DAAU,EATP;AAUHC,8DAAc;AAVX;AAHoC,yCAAxB,CAAvB;AAgBAzC,6DAAW6B,SAAX,CAAqBa,KAArB,CAA2B,UAACC,IAAD,EAAU;AACjCzC,+CAAGC,UAAH,CAAc;AACVC,uDADU,mBACFwC,KADE,EACI;AACV5C,yEAAWuB,YAAX,GAA0B,CAACvB,qBAAWuB,YAAtC;AACA,wDAAGqB,MAAMtC,WAAN,CAAkB,gBAAlB,CAAH,EAAuC;AACnCI,gEAAQC,GAAR,CAAY,WAAZ;AACAX,6EAAWC,YAAX,GAA0B,IAA1B;AACAD,6EAAW6B,SAAX,CAAqBgB,IAArB;AACA3C,2DAAGK,KAAH,CAAS;AACLH,mEADK,mBACG0C,IADH,EACQ;AACT;AACA9C,qFAAWQ,IAAX,GAAkBsC,KAAKtC,IAAvB;AACD;;;;;;;;;;;;;;;;;;;;;AAqBCN,mEAAGU,WAAH,CAAe;AACXmC,qFAAiB,IADN;AAEXC,0EAAM,OAFK;AAGX5C,2EAHW,mBAGH6C,IAHG,EAGE;AACTjD,6FAAWV,QAAX,GAAsB2D,KAAKpC,QAAL,CAAcvB,QAApC;AACAU,6FAAWc,SAAX,GAAuBmC,KAAKpC,QAAL,CAAcC,SAAd,GAAwB,aAA/C;AACAf,8EAAMT,QAAN,CAAeyB,MAAf,GAAwBkC,KAAKpC,QAAL,CAAcvB,QAAtC;AACAL,2EAAG+B,MAAH,CAAUC,IAAV,CAAejB,qBAAWc,SAA1B,EAAqC,UAAUI,GAAV,EAAeC,OAAf,EAAwB;AACzD,gFAAIC,SAAU,IAAInC,GAAGoC,WAAP,CAAmBF,OAAnB,CAAd;AACApB,kFAAMP,MAAN,CAAa8B,WAAb,GAA2BF,MAA3B;AACH,yEAHD;AAIH,qEAXU;AAYXX,wEAZW,kBAYL;AACFC,gFAAQC,GAAR,CAAY,iBAAZ;AACH;AAdU,iEAAf;AAgBAZ,sEAAMJ,IAAN,CAAWC,MAAX,GAAoB,IAApB;AACH;AA1CI,yDAAT;AA4CH,qDAhDD,MAiDI;AACAc,gEAAQC,GAAR,CAAY,WAAZ;AACAX,6EAAW6B,SAAX,CAAqBgB,IAArB;AACA9C,8DAAMJ,IAAN,CAAWC,MAAX,GAAoB,KAApB;AACH;AACJ;AAzDS,6CAAd;AA2DH,yCA5DD;AA6DAI,6DAAW6B,SAAX,CAAqBqB,IAArB;AACH;AAlFY,iCAAjB;AAoFH;AACJ;AACJ,iBA3IS;AA4IVzC,sBAAK,gBAAY;AACbC,4BAAQC,GAAR,CAAY,QAAZ;AACH;AA9IS,aAAd;AAgJH,SAjJD,MAkJI;AACA,iBAAKhB,IAAL,CAAUC,MAAV,GAAmB,IAAnB;AACA,gBAAGI,qBAAW6B,SAAd,EAAwB;AACpB7B,qCAAW6B,SAAX,CAAqBgB,IAArB;AACH;AACD,iBAAKvD,QAAL,CAAcyB,MAAd,GAAuBf,qBAAWV,QAAlC;AACAL,eAAG+B,MAAH,CAAUC,IAAV,CAAejB,qBAAWc,SAA1B,EAAqC,UAAUI,GAAV,EAAeC,OAAf,EAAwB;AACzD,oBAAIC,SAAU,IAAInC,GAAGoC,WAAP,CAAmBF,OAAnB,CAAd;AACApB,sBAAMP,MAAN,CAAa8B,WAAb,GAA2BF,MAA3B;AACH,aAHD;AAIH;AACJ;AA3KI,CAAT","file":"userInfo.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\panel","sourcesContent":["import GameConfig from '../gameConfig';\ncc.Class({\n    extends: cc.Component,\n    properties: {\n        nickName:cc.Label,\n        avatar:cc.Sprite\n    },\n    onLoad () {\n        this.node.active = false;\n        this.getUserInfoNew();\n    },\n    start () {},\n    //新版授权\n    getUserInfoNew(){\n        var _this = this;\n        if(GameConfig.IS_AUTHORIZE == false){\n            wx.getSetting({\n                success: function(res){\n                    //已经授权\n                    if (res.authSetting['scope.userInfo']) {\n                        _this.node.active = true;\n                        GameConfig.IS_AUTHORIZE = true;\n                        wx.login({\n                            success(res){\n                                GameConfig.code = res.code;\n                               /* wx.request({\n                                    method:\"post\",\n                                    url:GameConfig.INTER_URL+\"/game/login\",\n                                    data:{\n                                        code:GameConfig.code\n                                    }\n                                    datatype:'json',\n                                    success:function (res) {\n                                        if(res.status == 1){\n                                            console.log(\"登陆成功\")\n                                        else{\n                                            switch(res.code){\n                                                case 1006:\n                                                    console.log(\"操作失败\")\n                                            }\n                                        }\n                                    },\n                                    error:function () {\n                                        console.log(\"连接错误\")\n                                    }\n                                })*/\n                            },\n                            fail(){\n                                console.log(\"调用接口失败\")\n                            }\n                        })\n                        //调用 getUserInfo 获取头像昵称\n                        wx.getUserInfo({\n                            success: function(res){\n                                GameConfig.nickName = res.userInfo.nickName;\n                                GameConfig.avatarUrl = res.userInfo.avatarUrl+'?aaa=aa.jpg';\n                                _this.nickName.string = res.userInfo.nickName;\n                                cc.loader.load(GameConfig.avatarUrl, function (err, texture) {\n                                    var sprite  = new cc.SpriteFrame(texture);\n                                    _this.avatar.spriteFrame = sprite;\n                                });\n                            }\n                        })\n                    }\n                    //未授权\n                    else{\n                        //判断用户是否做过授权操作\n                        if(!GameConfig.IS_AUTHS_OPE){\n                            //获取手机信息\n                            wx.getSystemInfo({\n                                success(res){\n                                    var width = res.screenWidth;\n                                    var height = res.screenHeight;\n                                    GameConfig.auths_Btn = wx.createUserInfoButton({\n                                        type: 'text',\n                                        text: '微信授权',\n                                        style: {\n                                            left: (width-200)/2,\n                                            top: (height-100)/2-40,\n                                            width:200,\n                                            height: 100,\n                                            lineHeight: 100,\n                                            backgroundColor: '#05920a',\n                                            color: '#ffffff',\n                                            textAlign: 'center',\n                                            fontSize: 30,\n                                            borderRadius: 20\n                                        }\n                                    })\n                                    GameConfig.auths_Btn.onTap((res1) => {\n                                        wx.getSetting({\n                                            success(auths){\n                                                GameConfig.IS_AUTHS_OPE = !GameConfig.IS_AUTHS_OPE\n                                                if(auths.authSetting[\"scope.userInfo\"]){\n                                                    console.log(\"==已经授权===\")\n                                                    GameConfig.IS_AUTHORIZE = true;\n                                                    GameConfig.auths_Btn.hide();\n                                                    wx.login({\n                                                        success(res2){\n                                                            //获得个人信息\n                                                            GameConfig.code = res2.code\n                                                           /* wx.request({\n                                                                method:\"post\",\n                                                                url:GameConfig.INTER_URL+\"/game/login\",\n                                                                data:{\n                                                                    code:GameConfig.code\n                                                                }\n                                                                datatype:'json',\n                                                                success:function (res) {\n                                                                    if(res.status == 1){\n                                                                        console.log(\"登陆成功\")\n                                                                    else{\n                                                                            switch(res.code){\n                                                                                case 1006:\n                                                                                    console.log(\"操作失败\")\n                                                                            }\n                                                                        }\n                                                                    },\n                                                                    error:function () {\n                                                                        console.log(\"连接错误\")\n                                                                    }\n                                                                })*/\n                                                            wx.getUserInfo({\n                                                                withCredentials: true,\n                                                                lang: 'zh_CN',\n                                                                success(res3){\n                                                                    GameConfig.nickName = res3.userInfo.nickName;\n                                                                    GameConfig.avatarUrl = res3.userInfo.avatarUrl+'?aaa=aa.jpg';\n                                                                    _this.nickName.string = res3.userInfo.nickName;\n                                                                    cc.loader.load(GameConfig.avatarUrl, function (err, texture) {\n                                                                        var sprite  = new cc.SpriteFrame(texture);\n                                                                        _this.avatar.spriteFrame = sprite;\n                                                                    });\n                                                                },\n                                                                fail(){\n                                                                    console.log(\"login:获取自己的信息失败\");\n                                                                }\n                                                            })\n                                                            _this.node.active = true;\n                                                        }\n                                                    })\n                                                }\n                                                else{\n                                                    console.log(\"==拒绝授权===\")\n                                                    GameConfig.auths_Btn.hide();\n                                                    _this.node.active = false;\n                                                }\n                                            }\n                                        })\n                                    })\n                                    GameConfig.auths_Btn.show()\n                                }\n                            })\n                        }\n                    }\n                },\n                fail:function () {\n                    console.log(\"调用接口失败\")\n                }\n            })\n        }\n        else{\n            this.node.active = true;\n            if(GameConfig.auths_Btn){\n                GameConfig.auths_Btn.hide();\n            }\n            this.nickName.string = GameConfig.nickName;\n            cc.loader.load(GameConfig.avatarUrl, function (err, texture) {\n                var sprite  = new cc.SpriteFrame(texture);\n                _this.avatar.spriteFrame = sprite;\n            });\n        }\n    }\n});\n"]}